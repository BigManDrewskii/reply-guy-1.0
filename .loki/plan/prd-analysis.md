# PRD Analysis - Reply Guy v2.0

**Date:** 2025-02-07
**Analyzer:** Loki Mode
**PRD:** reply-guy-prd.md (892 lines)

---

## PRD Completeness Verification ✓

### Required Sections (All Present)

| Section | Status | Notes |
|---------|--------|-------|
| Executive Summary | ✓ | Clear core loop defined |
| Design Direction | ✓ | Vercel aesthetic fully specified |
| Technical Architecture | ✓ | Stack decisions justified |
| Open Source Toolkit | ✓ | GitHub gems with research |
| Model Strategy | ✓ | Cost analysis provided |
| Scraping Strategy | ✓ | Three-tier fallback defined |
| Database Schema | ✓ | Dexie.js structure specified |
| Voice Training | ✓ | LLM-only approach (no TF.js) |
| WXT Project Structure | ✓ | Complete file tree |
| Implementation Roadmap | ✓ | 6 phases with tasks |
| Cost Analysis | ✓ | Per-profile breakdown |
| Privacy & Compliance | ✓ | Local-first principles |
| Open Questions | ✓ | All resolved in v2 |

**Verdict: PRD is COMPLETE and IMPLEMENTATION-READY** ✓

---

## Technical Requirements Extraction

### Non-Negotiable Constraints

1. **Extension Framework:** WXT (wxt.dev) - NOT Plasmo, NOT Jonghakseo
2. **UI Framework:** React 19 + shadcn/ui + Tailwind CSS v4
3. **Design System:** Vercel dark aesthetic (pure black #000, Geist fonts)
4. **Database:** Dexie.js 4.x with useLiveQuery()
5. **LLM Client:** @openrouter/sdk (official) → Claude Sonnet 4.5
6. **State Management:** Zustand 5.x + chrome.storage.local
7. **Manifest Version:** V3 (auto-generated by WXT)
8. **Starter Template:** imtiger/wxt-react-shadcn-tailwindcss-chrome-extension

### Critical Technical Decisions

| Decision | Rationale (from PRD) |
|----------|---------------------|
| **WXT over Plasmo** | 9K+ ⭐, superior HMR, auto-imports, 5MB→500KB tree-shaking |
| **Sonnet 4.5 only** | Cost optimization: $0.023/profile vs $0.055 with Opus |
| **LLM-only voice** | TF.js adds 2MB, browser embeddings fragile |
| **Dexie.js over idb** | useLiveQuery() for reactive UI, richer API |
| **Three-tier scraping** | DOM changes frequently, need fallbacks |
| **OpenRouter official SDK** | Native streaming, typed responses, ESM-first |

### Architecture Requirements

```
Content Script → Background → Side Panel (React)
     ↓                ↓              ↓
  Scraper        Dexie         OpenRouter LLM
  (DOM/a11y)    (Cache)       (Streaming)
```

**Critical Flow:**
1. Content script detects X/LinkedIn profile
2. Scrapes with fallback chain (DOM → a11y → screenshot)
3. Sends to background via chrome.runtime
4. Background checks Dexie cache (24hr TTL)
5. Opens side panel, relays data
6. Side panel calls OpenRouter (streaming)
7. Displays 3-5 voice-matched messages

---

## Gap Analysis

### Identified Gaps (None Critical)

| Area | Gap | Severity | Resolution |
|------|------|----------|------------|
| **Error Handling** | No retry strategy for API failures | Medium | Add exponential backoff |
| **Rate Limiting** | Mentioned in roadmap, no spec | Medium | Implement 1 req/5s |
| **Accessibility Tree** | Fallback specified, not detailed | Low | Implement in Phase 2 |
| **Offline Mode** | Not specified | Low | Features work offline after first load |
| **i18n** | Starter includes i18n, PRD doesn't mention | Very Low | Remove i18n or keep for future |

### Ambiguities Resolved

| Question | Resolution |
|----------|------------|
| **X or LinkedIn first?** | PRD: "X first (Phase 1-5). LinkedIn in Phase 6" |
| **How to handle DOM changes?** | PRD: "Three-tier fallback" + selector object pattern |
| **Voice training bootstrap?** | PRD: "10 manual examples + LLM extraction. No TF.js" |
| **Auto-log or manual confirm?** | PRD: "Manual: 'Did you send this?' toast after copy" |

---

## Implementation Readiness Checklist

### ✓ Ready (Already Done)
- [x] WXT starter cloned and building
- [x] Vercel dark theme configured
- [x] Directory structure created
- [x] Core dependencies installed (dexie, @openrouter/sdk, zustand)
- [x] Database schema defined
- [x] LLM client stub created
- [x] Component stubs created

### Pending (Phase 1-6)
- [ ] Content script scraper implementation
- [ ] Background service worker messaging
- [ ] Side panel React app wiring
- [ ] OpenRouter API integration
- [ ] Streaming message display
- [ ] Voice training wizard
- [ ] Conversation history tracking
- [ ] LinkedIn scraper (Phase 6)

---

## Risk Assessment

| Risk | Probability | Impact | Mitigation |
|------|-------------|--------|------------|
| **X/LinkedIn DOM changes** | High | Medium | Three-tier fallback, selector object pattern |
| **OpenRouter rate limits** | Medium | High | 24hr cache, rate limiter, fallback models |
| **Extension size creep** | Medium | Medium | Tree-shaking, code splitting, no heavy deps |
| **Voice detection accuracy** | Low | Low | User feedback loop, manual editing enabled |
| **Chrome Web Store approval** | Low | High | No auto-sending, manual copy-paste only |

---

## Quality Gates Definition

### Phase 1: Skeleton ✓
- [ ] Extension installs in Chrome
- [ ] Side panel opens on x.com/* profiles
- [ ] Loading shimmer displays correctly
- [ ] Vercel theme applied everywhere

### Phase 2: Scraping + Analysis
- [ ] X scraper extracts name, handle, bio, followers
- [ ] Analysis cache works (24hr TTL)
- [ ] OpenRouter streaming renders token-by-token
- [ ] Tested on 10+ real X profiles

### Phase 3: Message Generation
- [ ] 3-5 messages generated per profile
- [ ] Copy button writes to clipboard
- [ ] Voice match scores display
- [ ] Regenerate functionality works

### Phase 4: Voice Training
- [ ] Voice training wizard functional
- [ ] LLM extracts voice fingerprint
- [ ] Messages match trained voice
- [ ] Blind test: user can't distinguish AI vs self

### Phase 5: Conversation History
- [ ] Conversations logged to Dexie
- [ ] Duplicate warning shows on re-contact
- [ ] Follow-up generation includes context
- [ ] Analytics dashboard functional

### Phase 6: LinkedIn + Polish
- [ ] LinkedIn scraper functional
- [ ] Tested on 50 LinkedIn profiles
- [ ] Zero crashes across both platforms
- [ ] <2 min from profile to sent message
- [ ] Keyboard shortcuts work (Cmd+Shift+R)

---

## Dependencies

### External Services
- **OpenRouter API:** Required for all LLM calls
- **GitHub (optional):** For cloning starter template

### Browser APIs
- `chrome.runtime` - Messaging
- `chrome.storage.local` - State persistence
- `chrome.sidePanel` - Side panel API
- `chrome.debugger` - Accessibility tree fallback
- `clipboard` - Copy message action

---

## Success Criteria

### Must Have (P0)
- [ ] Extension loads without errors
- [ ] Scrapes X profiles accurately
- [ ] Generates personalized messages
- [ ] Messages copy to clipboard
- [ ] Voice training improves message quality

### Should Have (P1)
- [ ] 24hr analysis cache
- [ ] Conversation history
- [ ] Duplicate detection
- [ ] LinkedIn support
- [ ] Keyboard shortcuts

### Nice to Have (P2)
- [ ] Follow-up suggestions
- [ ] Analytics dashboard
- [ ] Message templates
- [ ] Bulk export

---

## Estimated Timeline

Based on PRD roadmap (30 days total):

| Phase | Duration | Dependencies |
|-------|----------|--------------|
| Phase 1: Skeleton | 3 days | None |
| Phase 2: Scraping + Analysis | 4 days | Phase 1 |
| Phase 3: Message Generation | 5 days | Phase 2 |
| Phase 4: Voice Training | 5 days | Phase 3 |
| Phase 5: Conversation History | 5 days | Phase 4 |
| Phase 6: LinkedIn + Polish | 8 days | Phase 5 |

**Total:** 30 development days
**Buffer:** +20% for unforeseen issues = **36 days**

---

## Next Steps

1. ✅ Complete DISCOVERY phase (this analysis)
2. ⏳ Generate implementation task breakdown (discovery-2)
3. ⏳ Create detailed implementation plan (discovery-3)
4. ⏳ Begin Phase 1: Skeleton development

---

**Analysis Status:** COMPLETE ✓
**Ready for Implementation:** YES
**Confidence Level:** HIGH (95%)
