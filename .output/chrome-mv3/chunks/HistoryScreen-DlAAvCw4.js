import{c as O,e as w,r as i,j as e}from"./sidepanel-D81KDWu8.js";import{l as Y,C as R,b as F,c as J,a as $,B as k,d as z}from"./badge-2-8IB16q.js";import{I as K}from"./input-CGOaOH3L.js";import{C as V}from"./dialog-BsPt90--.js";import{g as Z,d as ee,u as te}from"./crm-CZr0xo1M.js";import{E as se}from"./external-link-0Vmnelh5.js";import"./button-cslzYFV6.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=O("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=O("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=O("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);function ne(d,g,l){var b,o;typeof d=="function"?(b=g||[],o=l):(b=[],o=g);var u=w.useRef({hasResult:!1,result:o,error:null}),C=w.useReducer(function(n){return n+1},0);C[0];var y=C[1],S=w.useMemo(function(){var n=typeof d=="function"?d():d;if(!n||typeof n.subscribe!="function")throw d===n?new TypeError("Given argument to useObservable() was neither a valid observable nor a function."):new TypeError("Observable factory given to useObservable() did not return a valid observable.");if(!u.current.hasResult&&typeof window<"u"&&(typeof n.hasValue!="function"||n.hasValue()))if(typeof n.getValue=="function")u.current.result=n.getValue(),u.current.hasResult=!0;else{var m=n.subscribe(function(c){u.current.result=c,u.current.hasResult=!0});typeof m=="function"?m():m.unsubscribe()}return n},b);if(w.useDebugValue(u.current.result),w.useEffect(function(){var n=S.subscribe(function(m){var c=u.current;(c.error!==null||c.result!==m)&&(c.error=null,c.result=m,c.hasResult=!0,y())},function(m){var c=u.current;c.error!==m&&(c.error=m,y())});return typeof n=="function"?n:n.unsubscribe.bind(n)},b),u.current.error)throw u.current.error;return u.current.result}function _(d,g,l){return ne(function(){return Y(d)},g||[],l)}const oe={new:"bg-muted-foreground",contacted:"bg-info",replied:"bg-success",meeting:"bg-warning",converted:"bg-chart-1",archived:"bg-muted-foreground/40"},le=["new","contacted","replied","meeting","converted","archived"];function he(){const[d,g]=i.useState("conversations"),[l,b]=i.useState(""),[o,u]=i.useState("all"),[C,y]=i.useState(null),[S,n]=i.useState(null),[m,c]=i.useState(!1),[j,U]=i.useState(!1),[D,M]=i.useState(null),[T,A]=i.useState(null),[h,Q]=i.useState(null),P=30,f=_(()=>z.conversations.orderBy("sentAt").reverse().limit(100).toArray(),[],[]),v=_(()=>z.contacts.orderBy("lastContactedAt").reverse().toArray(),[],[]);i.useEffect(()=>{const t=window.matchMedia("(prefers-reduced-motion: reduce)");c(t.matches);const r=()=>c(t.matches);return t.addEventListener("change",r),()=>t.removeEventListener("change",r)},[]),i.useEffect(()=>{j&&Z().then(Q).catch(()=>{})},[j,v,f]);const L=i.useMemo(()=>{let t=f;if(o!=="all"&&(t=t.filter(r=>r.platform===o)),l){const r=l.toLowerCase();t=t.filter(s=>s.pageName.toLowerCase().includes(r)||s.sentMessage.toLowerCase().includes(r))}return t},[f,o,l]),N=i.useMemo(()=>{if(!f.length)return null;const t=f.length,r={},s={sent:0,responded:0,no_response:0},a=f.filter(p=>Date.now()-p.sentAt<10080*60*1e3).length;f.forEach(p=>{r[p.platform]=(r[p.platform]||0)+1,s[p.status]=(s[p.status]||0)+1});const x=t>0?Math.round(s.responded/t*100):0;return{total:t,byPlatform:r,byStatus:s,last7Days:a,responseRate:x}},[f]),I=i.useMemo(()=>{let t=v;if(o!=="all"&&(t=t.filter(r=>r.platform===o)),l){const r=l.toLowerCase();t=t.filter(s=>s.name.toLowerCase().includes(r)||(s.bio||"").toLowerCase().includes(r)||(s.username||"").toLowerCase().includes(r))}return t},[v,o,l]),q=async t=>{await z.conversations.delete(t),M(null),y(null)},G=async t=>{await ee(t),A(null),n(null)},H=async(t,r)=>{await te(t,r)},W=(t=>{const r={};return t.forEach(s=>{const a=new Date(s.sentAt).toLocaleDateString();r[a]||(r[a]=[]),r[a].push(s)}),r})(L),E=t=>{switch(t){case"x":return"X";case"linkedin":return"in";case"github":return"GH";default:return"W"}},X=t=>{const r=Date.now()-t,s=Math.floor(r/6e4),a=Math.floor(r/36e5),x=Math.floor(r/864e5);return s<1?"just now":s<60?`${s}m ago`:a<24?`${a}h ago`:x<7?`${x}d ago`:new Date(t).toLocaleDateString()};return e.jsxs("div",{className:"space-y-4 stagger-children",children:[e.jsxs("div",{className:"flex rounded-xl bg-muted/50 p-1 gap-1",children:[e.jsxs("button",{onClick:()=>g("conversations"),className:`flex-1 py-2 px-3 rounded-lg text-xs font-medium transition-all duration-[200ms] ${d==="conversations"?"bg-card text-foreground shadow-xs":"text-muted-foreground hover:text-foreground/80"}`,children:["Messages ",f.length>0&&`(${f.length})`]}),e.jsxs("button",{onClick:()=>g("contacts"),className:`flex-1 py-2 px-3 rounded-lg text-xs font-medium transition-all duration-[200ms] ${d==="contacts"?"bg-card text-foreground shadow-xs":"text-muted-foreground hover:text-foreground/80"}`,children:["Contacts ",v.length>0&&`(${v.length})`]})]}),e.jsxs("div",{className:"flex gap-2.5",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ae,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground pointer-events-none"}),e.jsx(K,{placeholder:d==="conversations"?"Search messages...":"Search contacts...",size:"md",value:l,onChange:t=>b(t.target.value),"aria-label":"Search",className:"pl-9"})]}),e.jsx("button",{onClick:()=>U(!j),className:`w-9 h-9 flex items-center justify-center rounded-xl border transition-all duration-[200ms] ${j?"bg-foreground text-background border-foreground":"bg-card text-muted-foreground border-border/40 hover:text-foreground hover:border-border/60"}`,"aria-label":"Toggle analytics","aria-pressed":j,children:e.jsx(re,{size:14})})]}),j&&e.jsxs(R,{variant:"default",className:"animate-fade-in",children:[e.jsx(F,{children:e.jsx(J,{children:"Analytics"})}),e.jsxs($,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"text-center p-3 rounded-xl bg-background/50",children:[e.jsx("p",{className:"text-xl font-bold tabular-nums text-foreground",children:(h==null?void 0:h.totalContacts)||v.length}),e.jsx("p",{className:"text-[10px] text-muted-foreground mt-0.5",children:"Contacts"})]}),e.jsxs("div",{className:"text-center p-3 rounded-xl bg-background/50",children:[e.jsx("p",{className:"text-xl font-bold tabular-nums text-foreground",children:(N==null?void 0:N.total)||0}),e.jsx("p",{className:"text-[10px] text-muted-foreground mt-0.5",children:"Messages"})]}),e.jsxs("div",{className:"text-center p-3 rounded-xl bg-background/50",children:[e.jsxs("p",{className:"text-xl font-bold tabular-nums text-foreground",children:[(N==null?void 0:N.responseRate)||0,"%"]}),e.jsx("p",{className:"text-[10px] text-muted-foreground mt-0.5",children:"Reply Rate"})]})]}),h&&h.topAngles.length>0&&e.jsxs("div",{className:"pt-3.5 mt-3.5 border-t border-border/30",children:[e.jsx("p",{className:"text-[10px] text-muted-foreground mb-2",children:"Top Angles"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:h.topAngles.map(({angle:t,count:r})=>e.jsxs(k,{variant:"outline",size:"sm",children:[t," (",r,")"]},t))})]}),h&&Object.keys(h.contactsByPlatform).length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5 pt-3.5 mt-3.5 border-t border-border/30",children:Object.entries(h.contactsByPlatform).map(([t,r])=>e.jsxs(k,{variant:"outline",size:"sm",children:[E(t)," ",r]},t))})]})]}),e.jsx("div",{className:"flex gap-1.5",children:["all","x","linkedin","github"].map(t=>e.jsx("button",{onClick:()=>u(t),className:`px-3 py-1.5 rounded-full text-xs font-medium transition-all duration-[200ms] ${o===t?"bg-foreground text-background":"bg-muted/40 text-muted-foreground hover:text-foreground border border-border/20"}`,"aria-pressed":o===t,children:t==="all"?"All":t.charAt(0).toUpperCase()+t.slice(1)},t))}),d==="conversations"&&e.jsx(e.Fragment,{children:L.length===0?e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:l||o!=="all"?"No conversations match your search.":"No conversations yet."}),!l&&o==="all"&&e.jsx("p",{className:"text-xs text-muted-foreground/50 mt-1.5",children:"Copy and send a message to start tracking."})]}):Object.entries(W).map(([t,r])=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-[10px] font-semibold uppercase tracking-[0.06em] text-muted-foreground/50 px-1 pt-1",children:t===new Date().toLocaleDateString()?"Today":t}),r.map(s=>{const a=L.findIndex(p=>p.id===s.id),x=C===s.id;return e.jsx(R,{variant:"default",className:`cursor-pointer transition-all duration-[200ms] ${x?"ring-1 ring-ring/20":""}`,style:m?{opacity:1}:{animation:`fade-in-up 200ms ${a*P}ms forwards`,opacity:0},onClick:()=>y(x?null:s.id),children:e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-xl bg-muted/50 flex items-center justify-center text-[10px] font-semibold text-muted-foreground",children:E(s.platform)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground truncate",children:s.pageName}),e.jsx("span",{className:"text-[10px] text-muted-foreground/50 tabular-nums shrink-0",children:new Date(s.sentAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),!x&&e.jsx("p",{className:"text-xs text-muted-foreground truncate mt-1",children:s.sentMessage}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${s.status==="sent"?"bg-info":s.status==="responded"?"bg-success":"bg-muted-foreground"}`}),e.jsx("span",{className:"text-[10px] text-muted-foreground capitalize",children:s.status.replace("_"," ")}),e.jsx("span",{className:"text-[10px] text-muted-foreground/30",children:"·"}),e.jsx("span",{className:"text-[10px] text-muted-foreground/60 capitalize",children:s.angle})]}),x&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-border/30",children:[e.jsx("p",{className:"text-sm leading-relaxed text-foreground/85 whitespace-pre-wrap",children:s.sentMessage}),e.jsx("div",{className:"flex items-center justify-end mt-3",children:e.jsxs("button",{onClick:p=>{p.stopPropagation(),M({id:s.id,name:s.pageName})},className:"flex items-center gap-1.5 text-[11px] text-destructive/60 hover:text-destructive transition-colors duration-200","aria-label":`Delete conversation with ${s.pageName}`,children:[e.jsx(B,{size:12}),"Delete"]})})]})]})]})})},s.id)})]},t))}),d==="contacts"&&e.jsx(e.Fragment,{children:I.length===0?e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:l||o!=="all"?"No contacts match your search.":"No contacts yet."}),!l&&o==="all"&&e.jsx("p",{className:"text-xs text-muted-foreground/50 mt-1.5",children:"Contacts are created automatically when you send messages."})]}):e.jsx("div",{className:"space-y-2",children:I.map((t,r)=>{const s=S===t.id;return e.jsx(R,{variant:"default",className:`cursor-pointer transition-all duration-[200ms] ${s?"ring-1 ring-ring/20":""}`,style:m?{opacity:1}:{animation:`fade-in-up 200ms ${r*P}ms forwards`,opacity:0},onClick:()=>n(s?null:t.id??null),children:e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-9 h-9 rounded-xl bg-muted/50 flex items-center justify-center text-xs font-semibold text-muted-foreground",children:t.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground truncate",children:t.name}),e.jsx("span",{className:`w-1.5 h-1.5 rounded-full shrink-0 ${oe[t.status]}`})]}),e.jsx("span",{className:"text-[10px] text-muted-foreground/50 tabular-nums shrink-0",children:X(t.lastContactedAt)})]}),(t.headline||t.bio)&&!s&&e.jsx("p",{className:"text-xs text-muted-foreground truncate mt-1",children:t.headline||t.bio}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(k,{variant:"outline",size:"sm",children:E(t.platform)}),e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:[t.totalMessages," msg",t.totalMessages!==1?"s":""]}),e.jsx("span",{className:"text-[10px] text-muted-foreground/30",children:"·"}),e.jsx("span",{className:"text-[10px] text-muted-foreground capitalize",children:t.status})]}),s&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-border/30 space-y-3",children:[(t.headline||t.bio)&&e.jsx("p",{className:"text-xs leading-relaxed text-muted-foreground",children:t.headline||t.bio}),(t.location||t.followers)&&e.jsxs("div",{className:"flex items-center gap-2 text-[11px] text-muted-foreground/60",children:[t.location&&e.jsx("span",{children:t.location}),t.location&&t.followers&&e.jsx("span",{children:"·"}),t.followers&&e.jsxs("span",{children:[t.followers," followers"]})]}),t.tags&&t.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5",children:t.tags.map((a,x)=>e.jsx(k,{variant:"outline",size:"sm",children:a},x))}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-muted-foreground mb-1.5",children:"Status"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:le.map(a=>e.jsx("button",{onClick:x=>{x.stopPropagation(),t.id&&H(t.id,a)},className:`px-2.5 py-1 rounded-full text-[10px] font-medium transition-all duration-[200ms] ${t.status===a?"bg-foreground text-background":"bg-muted/40 text-muted-foreground hover:text-foreground"}`,children:a},a))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("a",{href:t.profileUrl,target:"_blank",rel:"noopener noreferrer",onClick:a=>a.stopPropagation(),className:"flex items-center gap-1.5 text-[11px] text-info hover:text-info/80 transition-colors duration-200",children:[e.jsx(se,{size:11}),"View Profile"]}),e.jsxs("button",{onClick:a=>{a.stopPropagation(),t.id&&A({id:t.id,name:t.name})},className:"flex items-center gap-1.5 text-[11px] text-destructive/60 hover:text-destructive transition-colors duration-200",children:[e.jsx(B,{size:12}),"Delete"]})]})]})]})]})})},t.id)})})}),D&&e.jsx(V,{title:"Delete Conversation?",description:`Delete the conversation with ${D.name}? This cannot be undone.`,confirmLabel:"Delete",onConfirm:()=>q(D.id),onClose:()=>M(null)}),T&&e.jsx(V,{title:"Delete Contact?",description:`Delete ${T.name} and all associated touchpoints? This cannot be undone.`,confirmLabel:"Delete",onConfirm:()=>G(T.id),onClose:()=>A(null)})]})}export{he as default};
