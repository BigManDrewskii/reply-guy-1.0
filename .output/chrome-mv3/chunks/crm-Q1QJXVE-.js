import{d as n}from"./badge-iP5lC0gp.js";async function w(t,o){var i;const c=d(t.url),s=await n.contacts.where("profileUrl").equals(c).first();if(s&&s.id)return await n.contacts.update(s.id,{lastContactedAt:Date.now(),totalMessages:s.totalMessages+1,...t.name&&{name:t.name},...t.bio&&{bio:t.bio},...t.location&&{location:t.location},...t.followers&&{followers:t.followers},...t.headline&&{headline:t.headline}}),s.id;const r={name:(o==null?void 0:o.personName)||t.name||t.ogTitle||"Unknown",platform:t.platform,profileUrl:c,username:t.username,bio:t.bio||t.headline||"",location:t.location||"",followers:t.followers||"",headline:t.headline||"",firstContactedAt:Date.now(),lastContactedAt:Date.now(),totalMessages:1,status:"new",notes:"",tags:((i=o==null?void 0:o.interests)==null?void 0:i.slice(0,3))||[]};return await n.contacts.add(r)}async function m(t,o){await n.contacts.update(t,{status:o})}async function C(t){await n.touchpoints.where("contactId").equals(t).delete(),await n.messageVariants.where("contactId").equals(t).delete(),await n.contacts.delete(t)}async function p(t){const o=d(t);return n.contacts.where("profileUrl").equals(o).first()}async function b(t){return await n.touchpoints.add(t)}async function A(){const t=await n.contacts.toArray(),o=await n.touchpoints.toArray(),c=await n.messageVariants.toArray(),s={};t.forEach(e=>{s[e.status]=(s[e.status]||0)+1});const r={};t.forEach(e=>{r[e.platform]=(r[e.platform]||0)+1});const u=c.filter(e=>e.copied).length,i=c.length>0?Math.round(c.reduce((e,a)=>e+a.voiceScore,0)/c.length):0,l={};o.forEach(e=>{l[e.angle]=(l[e.angle]||0)+1});const f=Object.entries(l).map(([e,a])=>({angle:e,count:a})).sort((e,a)=>a.count-e.count).slice(0,4);return{totalContacts:t.length,contactsByStatus:s,contactsByPlatform:r,totalTouchpoints:o.length,totalMessagesCopied:u,avgVoiceScore:i,topAngles:f}}function d(t){try{const o=new URL(t);let c=`${o.protocol}//${o.host}${o.pathname}`;return c=c.replace(/\/$/,""),c.toLowerCase()}catch{return t.toLowerCase().replace(/\/$/,"")}}export{b as a,p as c,C as d,w as f,A as g,m as u};
