import{c as G,r as l,j as e,C as ie,a as O,b as H,u as F,Z as ee,R as ce,d as de,P as ue}from"./sidepanel-BlZUykQz.js";import{P as X}from"./icons-BxUSB1BE.js";import{C as I,a as $,b as q,c as V,B as se,d as U}from"./badge-DdQVJnc0.js";import{L as me,B as D}from"./button-Bm5x_5Hu.js";import{E as te}from"./external-link-yAFvMliX.js";import{g as fe,a as he,A as Y}from"./alert-CCuqb-9h.js";import{s as ne,e as B,g as xe,a as ge}from"./openrouter-CtuvfVzy.js";import{f as Z,c as pe,a as be}from"./crm-BmLoR6MP.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=G("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=G("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=G("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=G("OctagonAlert",[["path",{d:"M12 16h.01",key:"1drbdi"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M15.312 2a2 2 0 0 1 1.414.586l4.688 4.688A2 2 0 0 1 22 8.688v6.624a2 2 0 0 1-.586 1.414l-4.688 4.688a2 2 0 0 1-1.414.586H8.688a2 2 0 0 1-1.414-.586l-4.688-4.688A2 2 0 0 1 2 15.312V8.688a2 2 0 0 1 .586-1.414l4.688-4.688A2 2 0 0 1 8.688 2z",key:"1fd625"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=G("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);function Ne(t){let s=0;for(let r=0;r<t.length;r++)s=t.charCodeAt(r)+((s<<5)-s);const n=Math.abs(s%360),a=(n+40)%360;return`linear-gradient(135deg, oklch(0.55 0.15 ${n}), oklch(0.45 0.18 ${a}))`}const K=l.forwardRef(({className:t,src:s,alt:n,fallback:a,size:r="md",variant:o="circle",status:m,loading:u=!1,error:c=!1,...d},g)=>{const[N,k]=l.useState(!1),z={xs:"w-5 h-5 text-[9px]",sm:"w-8 h-8 text-xs",md:"w-10 h-10 text-sm",lg:"w-12 h-12 text-base",xl:"w-16 h-16 text-lg"},C={xs:10,sm:12,md:14,lg:16,xl:18}[r],x={online:"var(--color-success)",offline:"var(--color-muted-foreground)",away:"var(--color-warning)",busy:"var(--color-destructive)"},w=c||N,h=w||!s,S=l.useMemo(()=>Ne(a||n||"?"),[a,n]);return e.jsxs("div",{ref:g,className:O("relative inline-flex flex-shrink-0",z[r],t),...d,children:[e.jsxs("div",{className:O("relative w-full h-full inline-flex items-center justify-center overflow-hidden","font-semibold text-white",{"rounded-full":o==="circle","rounded-lg":o==="square"}),style:h?{background:S}:void 0,children:[u&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-card/50 backdrop-blur-sm z-10",children:e.jsx(me,{size:C,className:"animate-spin text-muted-foreground"})}),h?w&&!a?e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-destructive/10",children:e.jsx(ie,{size:C,className:"text-destructive"})}):e.jsx("span",{className:"select-none","aria-label":n||a||"Avatar",children:a}):e.jsx("img",{src:s,alt:n||"",className:"w-full h-full object-cover",onError:()=>k(!0)})]}),m&&e.jsx("span",{className:O("absolute bottom-0 right-0 block rounded-full ring-2 ring-background",{"h-1.5 w-1.5":r==="xs"||r==="sm","h-2.5 w-2.5":r==="md"||r==="lg","h-3 w-3":r==="xl"}),style:{backgroundColor:x[m]},role:"status","aria-label":`Status: ${m}`})]})});K.displayName="Avatar";function ke({data:t}){var n,a;const s=X[t.platform]||X.generic;return e.jsx(I,{variant:"default",children:e.jsxs($,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(K,{src:t.avatarUrl,fallback:((n=t.name)==null?void 0:n.charAt(0).toUpperCase())||((a=t.ogTitle)==null?void 0:a.charAt(0).toUpperCase())||"?",size:"lg",variant:"circle"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("h2",{className:"text-[15px] font-semibold text-foreground truncate",children:t.name||t.ogTitle||t.title}),e.jsx(s,{size:14,className:"text-muted-foreground shrink-0"})]}),(t.location||t.company)&&e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5 truncate",children:[t.location,t.company].filter(Boolean).join(" · ")}),t.headline&&e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5 line-clamp-1",children:t.headline})]})]}),t.bio&&e.jsx("p",{className:"text-[13px] leading-relaxed text-muted-foreground line-clamp-3 mb-3",children:t.bio}),t.about&&!t.bio&&e.jsx("p",{className:"text-[13px] leading-relaxed text-muted-foreground line-clamp-3 mb-3",children:t.about}),t.followers&&e.jsx("div",{className:"flex items-center gap-3 text-xs text-muted-foreground pb-3 mb-3 border-b border-border/60",children:e.jsxs("span",{children:[e.jsx("span",{className:"text-foreground font-medium",children:t.followers})," followers"]})}),t.recentPosts&&t.recentPosts.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-medium text-muted-foreground uppercase tracking-wide mb-2",children:"Recent posts"}),e.jsx("div",{className:"space-y-1.5",children:t.recentPosts.slice(0,3).map((r,o)=>e.jsx("p",{className:"text-xs text-muted-foreground/80 line-clamp-2 leading-relaxed",children:r},o))})]})]})})}const Ce=l.memo(ke,(t,s)=>t.data.name===s.data.name&&t.data.headline===s.data.headline&&t.data.bio===s.data.bio);function Se({data:t}){return e.jsx(I,{variant:"default",children:e.jsxs($,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx(K,{fallback:e.jsx(ve,{size:20}),size:"md",variant:"circle"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h2",{className:"text-base font-semibold text-foreground truncate",children:t.hostname}),t.ogTitle&&e.jsx("p",{className:"text-sm text-muted-foreground mt-0.5 line-clamp-2",children:t.ogTitle}),!t.ogTitle&&t.h1&&e.jsx("p",{className:"text-sm text-muted-foreground mt-0.5 line-clamp-2",children:t.h1})]})]}),t.ogDescription&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-3 mb-3",children:t.ogDescription}),t.socialLinks&&t.socialLinks.length>0&&e.jsxs("div",{className:"border-t border-border pt-3 mt-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Detected social links"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.socialLinks.map((s,n)=>e.jsxs("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-primary hover:underline inline-flex items-center gap-1",children:[new URL(s).hostname,e.jsx(te,{size:12})]},n))})]}),t.email&&e.jsxs("div",{className:"border-t border-border pt-3 mt-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Contact"}),e.jsx("a",{href:`mailto:${t.email}`,className:"text-sm text-primary hover:underline",children:t.email})]})]})})}const Me=l.memo(Se,(t,s)=>t.data.hostname===s.data.hostname&&t.data.ogTitle===s.data.ogTitle&&t.data.ogDescription===s.data.ogDescription);function Ae({text:t,onCopy:s}){const[n,a]=l.useState(!1),r=async()=>{try{await navigator.clipboard.writeText(t),a(!0),s&&s(),setTimeout(()=>a(!1),1500)}catch(o){console.error("Failed to copy:",o)}};return e.jsx(D,{variant:n?"success":"primary",onClick:r,"aria-label":n?"Copied!":"Copy to clipboard",size:"md",className:"w-full",children:n?e.jsxs(e.Fragment,{children:[e.jsx(H,{size:15}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(ye,{size:15}),"Copy Message"]})})}const Te=l.memo(Ae,(t,s)=>t.text===s.text);function Re({initialMessage:t,onSave:s,onClose:n}){const[a,r]=l.useState(t),o=l.useRef(null),m=a.split(/\s+/).filter(Boolean).length,u=!a.trim()||a===t;return l.useEffect(()=>{o.current&&(o.current.focus(),o.current.setSelectionRange(a.length,a.length));const c=d=>{d.key==="Escape"&&n()};return document.addEventListener("keydown",c),()=>document.removeEventListener("keydown",c)},[]),e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm flex items-end justify-center z-50 animate-fade-in",onClick:n,role:"dialog","aria-modal":"true","aria-label":"Edit message",children:e.jsxs("div",{className:"w-full bg-card border-t border-border/60 rounded-t-2xl animate-slide-up",onClick:c=>c.stopPropagation(),children:[e.jsx("div",{className:"w-8 h-1 bg-muted-foreground/20 rounded-full mx-auto mt-3 mb-2"}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:"Edit Message"}),e.jsxs("span",{className:"text-[10px] text-muted-foreground tabular-nums",children:[m,"w"]})]}),e.jsx("textarea",{ref:o,value:a,onChange:c=>r(c.target.value),className:"w-full h-40 px-3 py-2.5 rounded-lg bg-background border border-border/60 text-[13px] text-foreground leading-relaxed resize-none focus:outline-none focus:ring-2 focus:ring-ring/40 focus:border-ring transition-colors",placeholder:"Edit your message...","aria-label":"Edit message content"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(D,{onClick:n,variant:"ghost",size:"sm",className:"flex-1",children:"Cancel"}),e.jsxs(D,{onClick:()=>s(a),variant:"primary",size:"sm",className:"flex-1",disabled:u,children:[e.jsx(H,{size:13}),"Save"]})]})]})]})})}function Q(t){const s=B(t);try{const a=JSON.parse(s);if(a.message)return a.message}catch{}const n=s.match(/"message"\s*:\s*"((?:[^"\\]|\\.)*)(?:"|$)/s);return n!=null&&n[1]?n[1].replace(/\\n/g,`
`).replace(/\\"/g,'"').replace(/\\\\/g,"\\").replace(/\\t/g,"	"):null}function Ee(){const[t,s]=l.useState({}),[n,a]=l.useState({}),[r,o]=l.useState({}),[m,u]=l.useState("service"),[c,d]=l.useState(null),[g,N]=l.useState(0),k=F(y=>y.apiKey),z=F(y=>y.preferredModel),C=l.useRef(null),x=l.useRef(null),w=l.useRef(null),h=l.useRef(null),S=3;l.useEffect(()=>{const y=()=>{chrome.storage.local.get("voiceProfile",f=>{f.voiceProfile&&d(f.voiceProfile)})};y();const E=()=>y();return chrome.storage.onChanged.addListener(E),()=>chrome.storage.onChanged.removeListener(E)},[]);const A=l.useCallback(()=>{h.current&&(h.current.abort(),h.current=null)},[]),T=l.useCallback(async(y,E,f)=>{if(!k)return;C.current=y,x.current=E,w.current=f,A();const L=new AbortController;h.current=L,o(R=>({...R,[f]:!0})),a(R=>({...R,[f]:""}));try{const R=fe(y,E,f,c||void 0);let p="";await ne([{role:"system",content:"You are a helpful assistant that generates personalized outreach messages."},{role:"user",content:R}],k,{signal:L.signal,onChunk:v=>{p+=v;const i=Q(p);i&&a(b=>({...b,[f]:i}));try{const b=B(p),j=JSON.parse(b);j.message&&j.wordCount&&(s(P=>({...P,[f]:j})),a(P=>({...P,[f]:""})))}catch{}},onComplete:v=>{try{const i=B(v),b=JSON.parse(i);s(j=>({...j,[f]:b})),a(j=>({...j,[f]:""})),o(j=>({...j,[f]:!1})),N(0)}catch{const i=Q(v);i&&s(b=>({...b,[f]:{message:i,wordCount:i.split(/\s+/).filter(Boolean).length,hook:"",voiceScore:50}})),a(b=>({...b,[f]:""})),o(b=>({...b,[f]:!1}))}h.current=null},onError:v=>{if(v instanceof DOMException&&v.name==="AbortError"){o(j=>({...j,[f]:!1})),a(j=>({...j,[f]:""}));return}const i=v instanceof Error?v.message:"Generation failed";if((i.includes("network")||i.includes("timeout")||i.includes("503")||i.includes("502"))&&g<S){N(P=>P+1);const j=Math.pow(2,g)*1e3;setTimeout(()=>{C.current&&x.current&&w.current&&T(C.current,x.current,w.current)},j)}else o(j=>({...j,[f]:!1})),a(j=>({...j,[f]:""})),N(0);h.current=null}},z)}catch(R){if(R instanceof DOMException&&R.name==="AbortError"){o(p=>({...p,[f]:!1})),a(p=>({...p,[f]:""}));return}o(p=>({...p,[f]:!1})),a(p=>({...p,[f]:""})),h.current=null}},[k,c,g,A]),M=l.useCallback(async(y,E,f)=>{s(L=>({...L,[f]:null})),a(L=>({...L,[f]:""})),await T(y,E,f)},[T]);return{messages:t,streamingText:n,isGenerating:r,selectedAngle:m,setSelectedAngle:u,generateMessage:T,regenerateMessage:M,cancelGeneration:A,setMessages:s}}const J=l.createContext(void 0),W=l.forwardRef(({defaultValue:t,value:s,onValueChange:n,children:a,className:r},o)=>{const[m,u]=l.useState(t),c=s??m,d=g=>{s===void 0&&u(g),n==null||n(g)};return e.jsx(J.Provider,{value:{value:c,onValueChange:d},children:e.jsx("div",{ref:o,className:r,children:a})})});W.displayName="TabsRoot";const re=l.forwardRef(({children:t,className:s},n)=>e.jsx("div",{ref:n,role:"tablist","aria-orientation":"horizontal",className:O("inline-flex w-full items-center gap-0.5 rounded-lg bg-muted/40 p-0.5",s),children:t}));re.displayName="TabsList";const oe=l.forwardRef(({value:t,children:s,disabled:n=!1,className:a},r)=>{const o=l.useContext(J);if(!o)throw new Error("TabsTrigger must be used within TabsRoot");const{value:m,onValueChange:u}=o,c=m===t;return e.jsx("button",{ref:r,type:"button",disabled:n,role:"tab","aria-selected":c,"aria-controls":`panel-${t}`,id:`tab-${t}`,tabIndex:c?0:-1,onClick:()=>!n&&u(t),onKeyDown:d=>{var k,z,C,x,w,h,S;const g=Array.from(((k=d.currentTarget.parentElement)==null?void 0:k.querySelectorAll('[role="tab"]'))||[]),N=g.indexOf(d.currentTarget);switch(d.key){case"ArrowLeft":case"ArrowRight":d.preventDefault();const A=d.key==="ArrowLeft"?-1:1,T=(N+A+g.length)%g.length;(z=g[T])==null||z.focus(),(C=g[T])==null||C.click();break;case"Home":d.preventDefault(),(x=g[0])==null||x.focus(),(w=g[0])==null||w.click();break;case"End":d.preventDefault(),(h=g[g.length-1])==null||h.focus(),(S=g[g.length-1])==null||S.click();break;case"Enter":case" ":d.preventDefault(),d.currentTarget.click();break}},className:O("relative flex-1 px-3 py-1.5 rounded-md text-xs font-medium transition-all duration-150 ease-in-out","focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-1 focus-visible:ring-offset-background","disabled:opacity-50 disabled:cursor-not-allowed",{"bg-card text-foreground shadow-xs":c,"text-muted-foreground hover:text-foreground":!c},a),children:s})});oe.displayName="TabsTrigger";const le=l.forwardRef(({value:t,children:s,className:n},a)=>{const r=l.useContext(J);if(!r)throw new Error("TabsContent must be used within TabsRoot");const{value:o}=r;return o===t?e.jsx("div",{ref:a,role:"tabpanel",id:`panel-${t}`,"aria-labelledby":`tab-${t}`,tabIndex:0,className:n,children:s}):null});le.displayName="TabsContent";const _=Object.assign(W,{Root:W,List:re,Trigger:oe,Content:le}),ze=["i hope this message finds you well","i wanted to reach out","i came across your","i was impressed by","i'd love to connect","i'd love to chat","i'd love to learn more","let me know if you'd be open","would you be open to","looking forward to connecting","looking forward to hearing","i believe there could be","i think there's a great opportunity","synergy","leverage","circle back","touch base","deep dive","game-changer","cutting-edge","innovative solution","value proposition","thought leader","paradigm shift","best-in-class","at the end of the day","in today's fast-paced","in the ever-evolving","it's worth noting","it goes without saying","needless to say","that being said","having said that","delve into","delve deeper","navigate the complexities","foster meaningful","cultivate","spearhead","revolutionize","streamline"],Le=["i noticed that","i was particularly","i'm reaching out because","i'm writing to","as someone who","as a fellow","given your expertise","given your background","with your experience","based on your"];function Ie(t){if(t.length<50)return 50;const s=t.toLowerCase().split(/\s+/),a=new Set(s).size/s.length,r=new Set;let o=0;for(let d=0;d<s.length-1;d++)r.add(`${s[d]} ${s[d+1]}`),o++;const m=o>0?r.size/o:1,u=Math.max(0,Math.min(100,(.7-a)*200)),c=Math.max(0,Math.min(100,(.9-m)*300));return(u+c)/2}function $e(t){const s=t.toLowerCase();let n=0;for(const a of ze)s.includes(a)&&n++;for(const a of Le)s.includes(a)&&n++;return Math.min(100,n*25)}function De(t){const s=t.split(/[.!?]+/).filter(u=>u.trim().length>0);if(s.length<3)return 30;const n=s.map(u=>u.trim().split(/\s+/).length),a=n.reduce((u,c)=>u+c,0)/n.length,r=n.reduce((u,c)=>u+Math.pow(c-a,2),0)/n.length,o=Math.sqrt(r),m=a>0?o/a:0;return Math.max(0,Math.min(100,(.5-m)*200))}function Oe(t){const s=t.toLowerCase(),n=["perhaps","maybe","possibly","potentially","arguably","it seems","it appears","it's possible","one might","could potentially","might consider","worth exploring","i think","i believe","in my opinion","from my perspective"],a=s.split(/\s+/).length;let r=0;for(const m of n){const u=new RegExp(m,"g"),c=s.match(u);c&&(r+=c.length)}const o=r/a*100;return Math.min(100,o*30)}function Pe(t){if(!t||t.length<20)return{score:0,label:"Too short to analyze",breakdown:{compression:0,phrases:0,structure:0,hedging:0},suggestions:[]};const s=Ie(t),n=$e(t),a=De(t),r=Oe(t),o=Math.round(s*.2+n*.4+a*.2+r*.2),m=Math.max(0,Math.min(100,o));let u;m<=20?u="Very human":m<=40?u="Mostly human":m<=60?u="Mixed":m<=80?u="Somewhat AI":u="Very AI";const c=[];return n>40&&c.push(`Remove generic AI phrases like "I hope this finds you well" or "I'd love to connect"`),a>50&&c.push("Vary your sentence lengths — mix short punchy sentences with longer ones"),r>40&&c.push('Reduce hedging words like "perhaps", "potentially", "might consider"'),s>50&&c.push("Use more specific, unique vocabulary instead of common generic terms"),{score:m,label:u,breakdown:{compression:s,phrases:n,structure:a,hedging:r},suggestions:c}}function Fe(t){return t>=80?{label:"Sounds like you",variant:"success"}:t>=60?{label:"Close match",variant:"info"}:t>=40?{label:"Moderate match",variant:"warning"}:{label:"Generic tone",variant:"error"}}function qe(t){return t<=20?{label:"Very human",color:"text-success"}:t<=40?{label:"Human",color:"text-info"}:t<=60?{label:"Mixed",color:"text-warning"}:{label:"AI-sounding",color:"text-destructive"}}function Ve({pageData:t,analysis:s,selectedAngle:n,onSelectAngle:a,onCopy:r,onRegenerate:o,onScheduleFollowUp:m}){const{messages:u,streamingText:c,isGenerating:d,generateMessage:g,regenerateMessage:N,setMessages:k}=Ee(),[z,C]=l.useState(!1),[x,w]=l.useState(!1),h=u[n],S=c[n]||"",A=d[n],T=A&&S.length>0,M=h?Pe(h.message):null,y=M?qe(M.score):null,E=p=>{a(p),!u[p]&&!d[p]&&g(t,s,p)},f=()=>{N(t,s,n),w(!1),o&&o()},L=()=>{r&&h&&r(h.message)};!h&&!A&&s&&g(t,s,n);const R=h?Fe(h.voiceScore):null;return e.jsxs(I,{variant:"default",children:[e.jsx(q,{children:e.jsx(V,{children:"Message"})}),e.jsxs($,{className:"space-y-3",children:[(s==null?void 0:s.outreachAngles)&&e.jsx(_.Root,{defaultValue:n,value:n,onValueChange:E,children:e.jsx(_.List,{children:s.outreachAngles.map(p=>e.jsx(_.Trigger,{value:p.angle,children:p.angle.charAt(0).toUpperCase()+p.angle.slice(1)},p.angle))})}),A&&!h&&!T&&e.jsxs("div",{role:"status","aria-live":"polite","aria-label":"Generating message",className:"space-y-2.5 py-3",children:[e.jsx("div",{className:"h-2.5 bg-muted rounded-full w-full animate-pulse"}),e.jsx("div",{className:"h-2.5 bg-muted rounded-full w-5/6 animate-pulse"}),e.jsx("div",{className:"h-2.5 bg-muted rounded-full w-4/6 animate-pulse"}),e.jsx("div",{className:"h-2.5 bg-muted rounded-full w-full animate-pulse"}),e.jsx("div",{className:"h-2.5 bg-muted rounded-full w-3/5 animate-pulse"})]}),T&&!h&&e.jsxs("div",{className:"rounded-lg bg-background/50 p-3",children:[e.jsxs("p",{className:"text-[13px] text-foreground whitespace-pre-wrap leading-relaxed",children:[S,e.jsx("span",{className:"inline-block w-[2px] h-[14px] bg-primary ml-0.5 align-middle animate-blink"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 pt-2 border-t border-border/30",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-primary animate-pulse"}),e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:["Generating · ",S.split(/\s+/).filter(Boolean).length,"w"]})]})]}),h&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-lg bg-background/50 p-3",children:e.jsx("p",{className:"text-[13px] text-foreground whitespace-pre-wrap leading-relaxed",children:h.message})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[R&&e.jsx(se,{variant:R.variant,size:"sm",children:R.label}),e.jsxs("span",{className:"text-[10px] text-muted-foreground tabular-nums",children:[h.voiceScore,"%"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[M&&y&&e.jsxs("button",{onClick:()=>w(!x),className:`flex items-center gap-1 text-[10px] ${y.color} hover:opacity-80 transition-opacity`,title:"AI-ness score — click for details",children:[e.jsx(ee,{size:10}),e.jsxs("span",{className:"tabular-nums",children:[M.score,"% AI"]})]}),e.jsx("span",{className:"text-[10px] text-muted-foreground/40",children:"·"}),e.jsxs("span",{className:"text-[10px] text-muted-foreground tabular-nums",children:[h.wordCount,"w"]})]})]}),x&&M&&e.jsxs("div",{className:"rounded-lg bg-background/50 border border-border/40 p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[11px] font-medium text-foreground",children:"AI Detection Breakdown"}),e.jsx("span",{className:`text-[11px] font-medium ${y.color}`,children:M.label})]}),e.jsx("div",{className:"space-y-1.5",children:[{label:"Phrases",value:M.breakdown.phrases,desc:"Common AI phrases"},{label:"Structure",value:M.breakdown.structure,desc:"Sentence uniformity"},{label:"Hedging",value:M.breakdown.hedging,desc:"Qualifiers & hedges"},{label:"Vocab",value:M.breakdown.compression,desc:"Word diversity"}].map(({label:p,value:v,desc:i})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground w-14 shrink-0",children:p}),e.jsx("div",{className:"flex-1 h-1.5 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-300 ${v<=30?"bg-success":v<=60?"bg-warning":"bg-destructive"}`,style:{width:`${Math.max(2,v)}%`}})}),e.jsx("span",{className:"text-[9px] text-muted-foreground/60 w-6 text-right tabular-nums",children:v})]},p))}),M.suggestions.length>0&&e.jsxs("div",{className:"pt-2 border-t border-border/30",children:[e.jsx("p",{className:"text-[10px] font-medium text-muted-foreground mb-1",children:"Suggestions"}),e.jsx("ul",{className:"space-y-0.5",children:M.suggestions.map((p,v)=>e.jsxs("li",{className:"text-[10px] text-muted-foreground/70 flex gap-1.5",children:[e.jsx("span",{className:"shrink-0",children:"•"}),e.jsx("span",{children:p})]},v))})]})]}),h.hook&&e.jsxs("p",{className:"text-[11px] text-muted-foreground/70 italic leading-relaxed",children:["Hook: ",h.hook]}),e.jsx(Te,{text:h.message,onCopy:L}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(D,{variant:"ghost",size:"sm",onClick:f,disabled:A,className:"flex-1",children:[e.jsx(ce,{size:13,className:A?"animate-spin":""}),"Regenerate"]}),e.jsxs(D,{variant:"ghost",size:"sm",onClick:()=>C(!0),className:"flex-1","aria-label":"Edit this message",children:[e.jsx(we,{size:13}),"Edit"]})]}),m&&e.jsxs(D,{variant:"ghost",size:"sm",onClick:m,className:"w-full text-muted-foreground",children:[e.jsx(ae,{size:13}),"Schedule Follow-ups"]})]})]}),z&&h&&e.jsx(Re,{initialMessage:h.message,onSave:p=>{k(v=>({...v,[n]:{...h,message:p,wordCount:p.split(/\s+/).filter(Boolean).length}})),C(!1)},onClose:()=>C(!1)})]})}const Be=l.memo(Ve,(t,s)=>{var n,a,r,o,m,u,c,d;return t.pageData.url===s.pageData.url&&t.selectedAngle===s.selectedAngle&&((n=t.analysis)==null?void 0:n.personName)===((a=s.analysis)==null?void 0:a.personName)&&((r=t.analysis)==null?void 0:r.confidence)===((o=s.analysis)==null?void 0:o.confidence)&&((u=(m=t.analysis)==null?void 0:m.outreachAngles)==null?void 0:u.length)===((d=(c=s.analysis)==null?void 0:c.outreachAngles)==null?void 0:d.length)});function Ge(t,s){return s?t==="x"?`https://x.com/messages/${s}`:t==="linkedin"?"https://www.linkedin.com/messaging/compose/":null:null}function Ue({isOpen:t,onClose:s,onLogged:n,platform:a,username:r}){const[o,m]=l.useState(!1);l.useEffect(()=>{t&&m(!0)},[t]);const u=l.useCallback(k=>{t&&(k.key==="Escape"?g():k.key==="Enter"&&d())},[t]);if(l.useEffect(()=>(document.addEventListener("keydown",u),()=>document.removeEventListener("keydown",u)),[u]),!t)return null;const c=Ge(a,r),d=()=>{n(),m(!1),setTimeout(()=>s(),200)},g=()=>{m(!1),setTimeout(()=>s(),200)},N=()=>{c&&window.open(c,"_blank"),d()};return e.jsx("div",{className:`
        fixed inset-0 bg-background/60 backdrop-blur-sm flex items-end justify-center z-50
        transition-opacity duration-200
        ${o?"opacity-100":"opacity-0"}
      `,onClick:g,role:"dialog","aria-modal":"true","aria-label":"Log conversation",children:e.jsxs("div",{className:`
          w-full bg-card border-t border-border/60 rounded-t-2xl p-5 pb-6
          transition-transform duration-200 ease-out
          ${o?"translate-y-0":"translate-y-full"}
        `,onClick:k=>k.stopPropagation(),children:[e.jsx("div",{className:"w-8 h-1 bg-muted-foreground/20 rounded-full mx-auto mb-4"}),e.jsxs("div",{className:"flex flex-col items-center mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-success/10 flex items-center justify-center mb-2",children:e.jsx(H,{size:18,className:"text-success"})}),e.jsx("p",{className:"text-sm font-medium text-foreground text-center",children:"Message copied"}),e.jsx("p",{className:"text-[11px] text-muted-foreground text-center mt-0.5",children:"Did you send it? We'll track it for you."})]}),e.jsxs("div",{className:"space-y-2",children:[c&&e.jsxs(D,{onClick:N,variant:"primary",size:"md",className:"w-full",children:[e.jsx(te,{size:14}),"Open ",a==="x"?"X":"LinkedIn"," DM"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(D,{onClick:d,variant:c?"ghost":"primary",size:"md",className:"flex-1",children:[e.jsx(H,{size:14}),"Sent it"]}),e.jsx(D,{onClick:g,variant:"ghost",size:"md",className:"flex-1",children:"Not yet"})]})]})]})})}function He({value:t,max:s=100,size:n="md",variant:a,showValue:r=!1,label:o,color:m,className:u,...c}){const d=Math.min(Math.max(t/s*100,0),100),g=a||(d>=60?"success":d>=30?"warning":"error"),N={default:"bg-muted-foreground",success:"bg-success",warning:"bg-warning",error:"bg-destructive"},k={default:"text-muted-foreground",success:"text-success",warning:"text-warning",error:"text-destructive"};return e.jsxs("div",{className:O("space-y-2",u),...c,children:[(o||r)&&e.jsxs("div",{className:"flex items-center justify-between",children:[o&&e.jsx("span",{className:"text-xs text-muted-foreground font-medium",children:o}),r&&e.jsxs("span",{className:O("text-xs font-semibold font-numerical tabular-nums",k[g]),children:[Math.round(d),"%"]})]}),e.jsx("div",{role:"progressbar","aria-valuenow":Math.round(d),"aria-valuemin":0,"aria-valuemax":100,className:O("w-full bg-muted rounded-full overflow-hidden",{"h-1":n==="sm","h-1.5":n==="md","h-2":n==="lg"}),children:e.jsx("div",{className:O("h-full rounded-full transition-all duration-500",m?"":N[g]),style:{width:`${d}%`,transitionTimingFunction:"cubic-bezier(0.4, 0.0, 0.2, 1)",...m&&{backgroundColor:m}}})})]})}function _e(){const[t,s]=l.useState(null),[n,a]=l.useState(!1),[r,o]=l.useState(!1),[m,u]=l.useState(0),[c,d]=l.useState(null),[g,N]=l.useState(0),k=F(y=>y.apiKey),z=F(y=>y.preferredModel),C=l.useRef(null),x=l.useRef(null),w=l.useRef(null),h=l.useRef(null),S=l.useRef(null),A=3,T=l.useCallback(()=>{S.current&&(S.current.abort(),S.current=null),C.current&&(clearTimeout(C.current),C.current=null),x.current&&(clearInterval(x.current),x.current=null),o(!1),u(0),a(!1),w.current=null},[]),M=l.useCallback(async y=>{if(!k){d("No API key configured");return}if(w.current===y.url&&(n||r))return;T(),w.current=y.url,h.current=y,o(!0),u(1),d(null);let E=1;x.current=setInterval(()=>{E--,u(E),E<=0&&x.current&&(clearInterval(x.current),x.current=null)},1e3),C.current=setTimeout(async()=>{o(!1),a(!0),s(null);try{const f=await xe(y.url);if(f){s(f),a(!1),w.current=null;return}const L=new AbortController;S.current=L;const R=he(y);let p="";await ne([{role:"system",content:"You are a helpful assistant that analyzes webpages for outreach purposes."},{role:"user",content:R}],k,{signal:L.signal,onChunk:v=>{p+=v;try{const i=B(p),b=JSON.parse(i);b.confidence&&s(b)}catch{}},onComplete:async v=>{try{const i=B(v),b=JSON.parse(i);s(b),await ge(y.url,b),N(0)}catch{d("Failed to parse analysis response")}a(!1),w.current=null,S.current=null},onError:v=>{if(v instanceof DOMException&&v.name==="AbortError")return;const i=v instanceof Error?v.message:"Analysis failed";if((i.includes("network")||i.includes("timeout")||i.includes("503")||i.includes("502"))&&g<A){N(P=>P+1);const j=Math.pow(2,g)*1e3;setTimeout(()=>{h.current&&M(h.current)},j)}else d(i),a(!1),w.current=null,S.current=null,N(0)}},z)}catch(f){if(f instanceof DOMException&&f.name==="AbortError")return;d(f instanceof Error?f.message:"Analysis failed"),a(!1),w.current=null,S.current=null}},1e3)},[k,n,r,T,g]);return{analysis:t,isAnalyzing:n,isDebouncing:r,debounceCountdown:m,error:c,analyzePage:M,cancelAnalysis:T}}function We(t,s,n,a){const r=t.name||"this person",o=a==="linkedin"?"LinkedIn connection/message":a==="x"?"X/Twitter DM":"message";return{contactId:t.id,contactName:t.name,originalAngle:n,originalMessage:s,createdAt:Date.now(),messages:[{sequence:1,delay:"3 days",delayMs:4320*60*1e3,tone:"gentle",prompt:`Write a gentle follow-up ${o} to ${r}. 

Context: I previously sent this message:
"${s.slice(0,300)}"

The follow-up should:
- Be SHORT (2-3 sentences max)
- Reference the original message briefly without repeating it
- Add a small new insight or value point
- NOT be pushy or desperate
- Sound natural and human
- End with a soft call to action

Tone: Casual, friendly, brief. Like bumping a thread.`},{sequence:2,delay:"7 days",delayMs:10080*60*1e3,tone:"value-add",prompt:`Write a value-add follow-up ${o} to ${r}.

Context: I sent an initial outreach message about ${n}, and a gentle follow-up 3 days later. Neither got a response.

The follow-up should:
- Be 3-4 sentences
- Lead with NEW value (share a relevant insight, resource, or observation about their work)
- NOT reference the previous messages directly
- Feel like a fresh, helpful message rather than a "just checking in"
- Include something specific about their recent activity or content
- End with a low-pressure question

Tone: Helpful, knowledgeable, not salesy.`},{sequence:3,delay:"14 days",delayMs:336*60*60*1e3,tone:"final",prompt:`Write a final, graceful follow-up ${o} to ${r}.

Context: This is the third and final follow-up. Previous messages about ${n} went unanswered.

The follow-up should:
- Be 2 sentences MAX
- Acknowledge they're busy (without being passive-aggressive)
- Leave the door open for future connection
- NOT guilt-trip or be desperate
- Be memorable and classy

Tone: Respectful, brief, confident. Like closing a door gently.`}]}}async function Ke(t){for(const s of t.messages){const n=`followup-${t.contactId}-${s.sequence}`,a=Date.now()+s.delayMs;try{await chrome.alarms.create(n,{when:a});const r=`followup_${t.contactId}_${s.sequence}`;await chrome.storage.local.set({[r]:{contactId:t.contactId,contactName:t.contactName,sequence:s.sequence,tone:s.tone,prompt:s.prompt,scheduledFor:a}}),await U.touchpoints.add({contactId:t.contactId,type:"follow_up_scheduled",angle:t.originalAngle,message:`Follow-up #${s.sequence} (${s.tone}) scheduled for ${s.delay}`,platform:"system",timestamp:Date.now()})}catch(r){console.warn(`[follow-up] Failed to schedule alarm ${n}:`,r)}}}const Je=[{value:"short",label:"Short",desc:"40-80w"},{value:"medium",label:"Medium",desc:"100-150w"},{value:"long",label:"Long",desc:"180-250w"}];function as({initialData:t}){const[s,n]=l.useState(t),[a,r]=l.useState(!t),[o,m]=l.useState("service"),[u,c]=l.useState(!1),[d,g]=l.useState(!1),[N,k]=l.useState(""),[z,C]=l.useState(null),{analysis:x,isAnalyzing:w,isDebouncing:h,debounceCountdown:S,error:A,analyzePage:T,cancelAnalysis:M}=_e(),y=F(i=>i.messageLength),E=F(i=>i.setMessageLength),{add:f}=de();l.useEffect(()=>{const i=b=>{if(b.currentPageData){const j=b.currentPageData.newValue;n(j),r(!1),g(!1),C(null)}};return chrome.storage.session.onChanged.addListener(i),()=>chrome.storage.session.onChanged.removeListener(i)},[]),l.useEffect(()=>{(async()=>{if(s!=null&&s.url)try{const b=await pe(s.url);if(b&&b.totalMessages>0){C(`You've already sent ${b.totalMessages} message${b.totalMessages>1?"s":""} to this contact.`);return}const j=await U.conversations.where("pageUrl").equals(s.url).count();j>0?C(`You've already sent ${j} message${j>1?"s":""} to this page.`):C(null)}catch{}})()},[s==null?void 0:s.url]);const L=()=>{s&&!x&&!w&&!d&&(g(!0),T(s))},R=i=>{i&&k(i),setTimeout(()=>c(!0),100)},p=async()=>{if(!(!s||!N))try{await U.conversations.add({id:`${Date.now()}-${Math.random().toString(36).slice(2,9)}`,platform:s.platform,pageUrl:s.url,pageName:(x==null?void 0:x.personName)||s.name||s.ogTitle||s.hostname,sentMessage:N,angle:o,sentAt:Date.now(),status:"sent"});try{const i=await Z(s,x||void 0);await be({contactId:i,type:"copied",angle:o,message:N,platform:s.platform,timestamp:Date.now(),messageLength:y})}catch(i){console.warn("[OutreachScreen] Failed to update contact:",i)}}catch(i){console.error("[OutreachScreen] Failed to log conversation:",i)}};if(a)return e.jsxs("div",{className:"space-y-3",children:[e.jsx(ue,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-3 bg-muted rounded w-1/4"}),e.jsx("div",{className:"h-3 bg-muted rounded w-full"}),e.jsx("div",{className:"h-3 bg-muted rounded w-5/6"})]})]});if(!s)return e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-[13px] leading-relaxed text-muted-foreground",children:"Waiting for page data..."})});const v=s.isProfile||s.name;return e.jsxs("div",{className:"space-y-3",children:[v?e.jsx(Ce,{data:s}):e.jsx(Me,{data:s}),s.isThread&&s.threadContext&&s.threadContext.length>0&&e.jsx(I,{variant:"default",children:e.jsxs($,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[e.jsx(je,{size:13,className:"text-info"}),e.jsxs("span",{className:"text-[11px] font-medium text-foreground",children:["Thread detected · ",s.threadContext.length," messages"]})]}),e.jsx("p",{className:"text-[11px] text-muted-foreground leading-relaxed",children:"Thread context will be used to generate more relevant messages."})]})}),z&&e.jsx(Y,{variant:"warning",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{size:14,className:"shrink-0"}),e.jsx("span",{children:z})]})}),A&&e.jsx(Y,{variant:"error",children:A}),s&&!x&&!w&&!h&&!d&&e.jsx(I,{variant:"default",children:e.jsxs($,{className:"p-5 text-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center mx-auto mb-3",children:e.jsx(ee,{size:18,className:"text-primary"})}),e.jsx("p",{className:"text-sm font-medium text-foreground mb-1",children:"Ready to analyze"}),e.jsxs("p",{className:"text-xs text-muted-foreground mb-4",children:["Generate personalized outreach for"," ",e.jsx("span",{className:"text-foreground font-medium",children:s.name||s.ogTitle||s.hostname})]}),e.jsx(D,{onClick:L,variant:"primary",size:"md",className:"w-full",children:"Analyze This Page"})]})}),h&&e.jsx(I,{variant:"default",children:e.jsxs($,{className:"p-4 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-info animate-pulse"}),e.jsx("span",{className:"text-xs font-medium text-foreground",children:"Starting analysis..."})]}),e.jsxs("p",{className:"text-[11px] text-muted-foreground",children:["Analyzing in ",S,"s"]}),e.jsx(D,{onClick:M,variant:"ghost",size:"xs",className:"mt-2",children:"Cancel"})]})}),w&&!x&&e.jsx(I,{variant:"default",children:e.jsxs($,{className:"p-4 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-info animate-pulse"}),e.jsx("span",{className:"text-xs font-medium text-foreground",children:"Analyzing page..."})]}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("div",{className:"h-2 bg-muted rounded-full w-full animate-pulse"}),e.jsx("div",{className:"h-2 bg-muted rounded-full w-3/4 animate-pulse"})]})]})}),x&&e.jsxs(e.Fragment,{children:[e.jsxs(I,{variant:"default",children:[e.jsx(q,{children:e.jsx(V,{children:"Confidence"})}),e.jsxs($,{children:[e.jsx(He,{value:x.confidence,showValue:!0,size:"md"}),x.confidenceReason&&e.jsx("p",{className:"text-[11px] leading-relaxed text-muted-foreground mt-2",children:x.confidenceReason})]})]}),x.summary&&e.jsxs(I,{variant:"default",children:[e.jsx(q,{children:e.jsx(V,{children:"Summary"})}),e.jsx($,{children:e.jsx("p",{className:"text-[13px] leading-relaxed text-muted-foreground",children:x.summary})})]}),x.interests&&x.interests.length>0&&e.jsxs(I,{variant:"default",children:[e.jsx(q,{children:e.jsx(V,{children:"Interests"})}),e.jsx($,{children:e.jsx("div",{className:"flex flex-wrap gap-1.5",children:x.interests.map((i,b)=>e.jsx(se,{variant:"outline",size:"sm",children:i},b))})})]}),e.jsxs(I,{variant:"default",children:[e.jsx(q,{children:e.jsx(V,{children:"Message Length"})}),e.jsx($,{children:e.jsx("div",{className:"flex rounded-lg bg-muted/50 p-0.5 gap-0.5",children:Je.map(i=>e.jsxs("button",{onClick:()=>E(i.value),className:`flex-1 py-1.5 px-2 rounded-md text-center transition-all duration-200 ${y===i.value?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"}`,children:[e.jsx("span",{className:"text-[11px] font-medium block",children:i.label}),e.jsx("span",{className:"text-[9px] opacity-60 block",children:i.desc})]},i.value))})})]})]}),x&&s&&e.jsx(Be,{pageData:s,analysis:x,selectedAngle:o,onSelectAngle:m,onCopy:R,onScheduleFollowUp:async()=>{if(!s||!N){f({title:"Copy a message first",variant:"error"});return}try{const i=await Z(s,x||void 0),b=await U.contacts.get(i);if(!b)return;const j=We(b,N,o,s.platform);await Ke(j),f({title:"Follow-ups scheduled",description:"3 reminders: 3d, 7d, 14d",variant:"success"})}catch(i){console.error("[OutreachScreen] Failed to schedule follow-ups:",i),f({title:"Failed to schedule follow-ups",variant:"error"})}}}),e.jsx(Ue,{isOpen:u,onClose:()=>c(!1),onLogged:p,platform:s.platform,username:s.username})]})}export{as as default};
