import{c as O,e as w,r as i,j as e}from"./sidepanel-BVNUtaom.js";import{l as Y,C as R,b as F,c as J,a as $,B as k,d as z}from"./badge-Db7Lyzlw.js";import{I as K}from"./input-DrC5cBoe.js";import{C as V}from"./dialog-DH9r7Azs.js";import{g as Z,d as ee,u as te}from"./crm-5vN5K5Y-.js";import{E as se}from"./external-link-BmvZkRcY.js";import"./button-BSa-vXH9.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=O("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=O("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=O("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);function ne(d,g,o){var b,l;typeof d=="function"?(b=g||[],l=o):(b=[],l=g);var c=w.useRef({hasResult:!1,result:l,error:null}),C=w.useReducer(function(n){return n+1},0);C[0];var N=C[1],S=w.useMemo(function(){var n=typeof d=="function"?d():d;if(!n||typeof n.subscribe!="function")throw d===n?new TypeError("Given argument to useObservable() was neither a valid observable nor a function."):new TypeError("Observable factory given to useObservable() did not return a valid observable.");if(!c.current.hasResult&&typeof window<"u"&&(typeof n.hasValue!="function"||n.hasValue()))if(typeof n.getValue=="function")c.current.result=n.getValue(),c.current.hasResult=!0;else{var m=n.subscribe(function(u){c.current.result=u,c.current.hasResult=!0});typeof m=="function"?m():m.unsubscribe()}return n},b);if(w.useDebugValue(c.current.result),w.useEffect(function(){var n=S.subscribe(function(m){var u=c.current;(u.error!==null||u.result!==m)&&(u.error=null,u.result=m,u.hasResult=!0,N())},function(m){var u=c.current;u.error!==m&&(u.error=m,N())});return typeof n=="function"?n:n.unsubscribe.bind(n)},b),c.current.error)throw c.current.error;return c.current.result}function _(d,g,o){return ne(function(){return Y(d)},g||[],o)}const le={new:"bg-muted-foreground",contacted:"bg-info",replied:"bg-success",meeting:"bg-warning",converted:"bg-chart-1",archived:"bg-muted-foreground/40"},oe=["new","contacted","replied","meeting","converted","archived"];function he(){const[d,g]=i.useState("conversations"),[o,b]=i.useState(""),[l,c]=i.useState("all"),[C,N]=i.useState(null),[S,n]=i.useState(null),[m,u]=i.useState(!1),[j,U]=i.useState(!1),[D,M]=i.useState(null),[T,A]=i.useState(null),[h,Q]=i.useState(null),P=30,p=_(()=>z.conversations.orderBy("sentAt").reverse().limit(100).toArray(),[],[]),v=_(()=>z.contacts.orderBy("lastContactedAt").reverse().toArray(),[],[]);i.useEffect(()=>{const t=window.matchMedia("(prefers-reduced-motion: reduce)");u(t.matches);const r=()=>u(t.matches);return t.addEventListener("change",r),()=>t.removeEventListener("change",r)},[]),i.useEffect(()=>{j&&Z().then(Q).catch(()=>{})},[j,v,p]);const L=i.useMemo(()=>{let t=p;if(l!=="all"&&(t=t.filter(r=>r.platform===l)),o){const r=o.toLowerCase();t=t.filter(s=>s.pageName.toLowerCase().includes(r)||s.sentMessage.toLowerCase().includes(r))}return t},[p,l,o]),y=i.useMemo(()=>{if(!p.length)return null;const t=p.length,r={},s={sent:0,responded:0,no_response:0},a=p.filter(f=>Date.now()-f.sentAt<10080*60*1e3).length;p.forEach(f=>{r[f.platform]=(r[f.platform]||0)+1,s[f.status]=(s[f.status]||0)+1});const x=t>0?Math.round(s.responded/t*100):0;return{total:t,byPlatform:r,byStatus:s,last7Days:a,responseRate:x}},[p]),I=i.useMemo(()=>{let t=v;if(l!=="all"&&(t=t.filter(r=>r.platform===l)),o){const r=o.toLowerCase();t=t.filter(s=>s.name.toLowerCase().includes(r)||(s.bio||"").toLowerCase().includes(r)||(s.username||"").toLowerCase().includes(r))}return t},[v,l,o]),q=async t=>{await z.conversations.delete(t),M(null),N(null)},G=async t=>{await ee(t),A(null),n(null)},H=async(t,r)=>{await te(t,r)},W=(t=>{const r={};return t.forEach(s=>{const a=new Date(s.sentAt).toLocaleDateString();r[a]||(r[a]=[]),r[a].push(s)}),r})(L),E=t=>{switch(t){case"x":return"X";case"linkedin":return"in";case"github":return"GH";default:return"W"}},X=t=>{const r=Date.now()-t,s=Math.floor(r/6e4),a=Math.floor(r/36e5),x=Math.floor(r/864e5);return s<1?"just now":s<60?`${s}m ago`:a<24?`${a}h ago`:x<7?`${x}d ago`:new Date(t).toLocaleDateString()};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex rounded-lg bg-muted/50 p-0.5 gap-0.5",children:[e.jsxs("button",{onClick:()=>g("conversations"),className:`flex-1 py-1.5 px-3 rounded-md text-[11px] font-medium transition-all ${d==="conversations"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"}`,children:["Messages ",p.length>0&&`(${p.length})`]}),e.jsxs("button",{onClick:()=>g("contacts"),className:`flex-1 py-1.5 px-3 rounded-md text-[11px] font-medium transition-all ${d==="contacts"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"}`,children:["Contacts ",v.length>0&&`(${v.length})`]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ae,{size:14,className:"absolute left-2.5 top-1/2 -translate-y-1/2 text-muted-foreground pointer-events-none"}),e.jsx(K,{placeholder:d==="conversations"?"Search messages...":"Search contacts...",size:"sm",value:o,onChange:t=>b(t.target.value),"aria-label":"Search",className:"pl-8"})]}),e.jsx("button",{onClick:()=>U(!j),className:`w-8 h-8 flex items-center justify-center rounded-lg border transition-colors ${j?"bg-primary text-primary-foreground border-primary":"bg-card text-muted-foreground border-border/60 hover:text-foreground"}`,"aria-label":"Toggle analytics","aria-pressed":j,children:e.jsx(re,{size:14})})]}),j&&e.jsxs(R,{variant:"default",children:[e.jsx(F,{children:e.jsx(J,{children:"Analytics"})}),e.jsxs($,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"text-center p-2 rounded-lg bg-background/50",children:[e.jsx("p",{className:"text-lg font-bold tabular-nums text-foreground",children:(h==null?void 0:h.totalContacts)||v.length}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Contacts"})]}),e.jsxs("div",{className:"text-center p-2 rounded-lg bg-background/50",children:[e.jsx("p",{className:"text-lg font-bold tabular-nums text-foreground",children:(y==null?void 0:y.total)||0}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Messages"})]}),e.jsxs("div",{className:"text-center p-2 rounded-lg bg-background/50",children:[e.jsxs("p",{className:"text-lg font-bold tabular-nums text-foreground",children:[(y==null?void 0:y.responseRate)||0,"%"]}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Reply Rate"})]})]}),h&&h.topAngles.length>0&&e.jsxs("div",{className:"pt-3 mt-3 border-t border-border/40",children:[e.jsx("p",{className:"text-[10px] text-muted-foreground mb-1.5",children:"Top Angles"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:h.topAngles.map(({angle:t,count:r})=>e.jsxs(k,{variant:"outline",size:"sm",children:[t," (",r,")"]},t))})]}),h&&Object.keys(h.contactsByPlatform).length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5 pt-3 mt-3 border-t border-border/40",children:Object.entries(h.contactsByPlatform).map(([t,r])=>e.jsxs(k,{variant:"outline",size:"sm",children:[E(t)," ",r]},t))})]})]}),e.jsx("div",{className:"flex gap-1.5",children:["all","x","linkedin","github"].map(t=>e.jsx("button",{onClick:()=>c(t),className:`px-2.5 py-1 rounded-md text-[11px] font-medium transition-all ${l===t?"bg-primary text-primary-foreground":"bg-muted/50 text-muted-foreground hover:text-foreground"}`,"aria-pressed":l===t,children:t==="all"?"All":t.charAt(0).toUpperCase()+t.slice(1)},t))}),d==="conversations"&&e.jsx(e.Fragment,{children:L.length===0?e.jsxs("div",{className:"py-10 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:o||l!=="all"?"No conversations match your search.":"No conversations yet."}),!o&&l==="all"&&e.jsx("p",{className:"text-[11px] text-muted-foreground/60 mt-1",children:"Copy and send a message to start tracking."})]}):Object.entries(W).map(([t,r])=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("p",{className:"text-[10px] font-medium uppercase tracking-wider text-muted-foreground/60 px-1 pt-1",children:t===new Date().toLocaleDateString()?"Today":t}),r.map(s=>{const a=L.findIndex(f=>f.id===s.id),x=C===s.id;return e.jsx(R,{variant:"default",className:`cursor-pointer transition-all ${x?"ring-1 ring-ring/30":""}`,style:m?{opacity:1}:{animation:`fade-in-up 200ms ${a*P}ms forwards`,opacity:0},onClick:()=>N(x?null:s.id),children:e.jsx($,{className:"p-3",children:e.jsxs("div",{className:"flex items-start gap-2.5",children:[e.jsx("div",{className:"flex-shrink-0 w-7 h-7 rounded-md bg-muted/60 flex items-center justify-center text-[10px] font-semibold text-muted-foreground",children:E(s.platform)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("h4",{className:"text-[13px] font-medium text-foreground truncate",children:s.pageName}),e.jsx("span",{className:"text-[10px] text-muted-foreground/60 tabular-nums shrink-0",children:new Date(s.sentAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),!x&&e.jsx("p",{className:"text-xs text-muted-foreground truncate mt-0.5",children:s.sentMessage}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5",children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${s.status==="sent"?"bg-info":s.status==="responded"?"bg-success":"bg-muted-foreground"}`}),e.jsx("span",{className:"text-[10px] text-muted-foreground capitalize",children:s.status.replace("_"," ")}),e.jsx("span",{className:"text-[10px] text-muted-foreground/40",children:"·"}),e.jsx("span",{className:"text-[10px] text-muted-foreground/60 capitalize",children:s.angle})]}),x&&e.jsxs("div",{className:"mt-2.5 pt-2.5 border-t border-border/40",children:[e.jsx("p",{className:"text-[13px] leading-relaxed text-foreground/90 whitespace-pre-wrap",children:s.sentMessage}),e.jsx("div",{className:"flex items-center justify-end mt-2.5",children:e.jsxs("button",{onClick:f=>{f.stopPropagation(),M({id:s.id,name:s.pageName})},className:"flex items-center gap-1 text-[10px] text-destructive/70 hover:text-destructive transition-colors","aria-label":`Delete conversation with ${s.pageName}`,children:[e.jsx(B,{size:11}),"Delete"]})})]})]})]})})},s.id)})]},t))}),d==="contacts"&&e.jsx(e.Fragment,{children:I.length===0?e.jsxs("div",{className:"py-10 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:o||l!=="all"?"No contacts match your search.":"No contacts yet."}),!o&&l==="all"&&e.jsx("p",{className:"text-[11px] text-muted-foreground/60 mt-1",children:"Contacts are created automatically when you send messages."})]}):e.jsx("div",{className:"space-y-1.5",children:I.map((t,r)=>{const s=S===t.id;return e.jsx(R,{variant:"default",className:`cursor-pointer transition-all ${s?"ring-1 ring-ring/30":""}`,style:m?{opacity:1}:{animation:`fade-in-up 200ms ${r*P}ms forwards`,opacity:0},onClick:()=>n(s?null:t.id??null),children:e.jsx($,{className:"p-3",children:e.jsxs("div",{className:"flex items-start gap-2.5",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-lg bg-gradient-to-br from-primary/20 to-primary/5 flex items-center justify-center text-[11px] font-semibold text-primary",children:t.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[e.jsx("h4",{className:"text-[13px] font-medium text-foreground truncate",children:t.name}),e.jsx("span",{className:`w-1.5 h-1.5 rounded-full shrink-0 ${le[t.status]}`})]}),e.jsx("span",{className:"text-[10px] text-muted-foreground/60 tabular-nums shrink-0",children:X(t.lastContactedAt)})]}),(t.headline||t.bio)&&!s&&e.jsx("p",{className:"text-xs text-muted-foreground truncate mt-0.5",children:t.headline||t.bio}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5",children:[e.jsx(k,{variant:"outline",size:"sm",children:E(t.platform)}),e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:[t.totalMessages," msg",t.totalMessages!==1?"s":""]}),e.jsx("span",{className:"text-[10px] text-muted-foreground/40",children:"·"}),e.jsx("span",{className:"text-[10px] text-muted-foreground capitalize",children:t.status})]}),s&&e.jsxs("div",{className:"mt-2.5 pt-2.5 border-t border-border/40 space-y-2.5",children:[(t.headline||t.bio)&&e.jsx("p",{className:"text-[12px] leading-relaxed text-muted-foreground",children:t.headline||t.bio}),(t.location||t.followers)&&e.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-muted-foreground/70",children:[t.location&&e.jsx("span",{children:t.location}),t.location&&t.followers&&e.jsx("span",{children:"·"}),t.followers&&e.jsxs("span",{children:[t.followers," followers"]})]}),t.tags&&t.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:t.tags.map((a,x)=>e.jsx(k,{variant:"outline",size:"sm",children:a},x))}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-muted-foreground mb-1",children:"Status"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:oe.map(a=>e.jsx("button",{onClick:x=>{x.stopPropagation(),t.id&&H(t.id,a)},className:`px-2 py-0.5 rounded text-[10px] font-medium transition-all ${t.status===a?"bg-primary text-primary-foreground":"bg-muted/50 text-muted-foreground hover:text-foreground"}`,children:a},a))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("a",{href:t.profileUrl,target:"_blank",rel:"noopener noreferrer",onClick:a=>a.stopPropagation(),className:"flex items-center gap-1 text-[10px] text-info hover:text-info/80 transition-colors",children:[e.jsx(se,{size:10}),"View Profile"]}),e.jsxs("button",{onClick:a=>{a.stopPropagation(),t.id&&A({id:t.id,name:t.name})},className:"flex items-center gap-1 text-[10px] text-destructive/70 hover:text-destructive transition-colors",children:[e.jsx(B,{size:11}),"Delete"]})]})]})]})]})})},t.id)})})}),D&&e.jsx(V,{title:"Delete Conversation?",description:`Delete the conversation with ${D.name}? This cannot be undone.`,confirmLabel:"Delete",onConfirm:()=>q(D.id),onClose:()=>M(null)}),T&&e.jsx(V,{title:"Delete Contact?",description:`Delete ${T.name} and all associated touchpoints? This cannot be undone.`,confirmLabel:"Delete",onConfirm:()=>G(T.id),onClose:()=>A(null)})]})}export{he as default};
