import{c as k,d as v,r as u,j as e}from"./sidepanel-DS6lTU98.js";import{l as T,C as D,b as A,c as V,a as S,B as z,d as M}from"./badge-4w6LEc2_.js";import{I}from"./input-DGpsbVHk.js";import{C as O}from"./dialog-CZ-gj8bi.js";import"./button-BEKyJbm1.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=k("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=k("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=k("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);function Q(n,f,d){var h,y;typeof n=="function"?(h=f||[],y=d):(h=[],y=f);var l=v.useRef({hasResult:!1,result:y,error:null}),N=v.useReducer(function(a){return a+1},0);N[0];var j=N[1],g=v.useMemo(function(){var a=typeof n=="function"?n():n;if(!a||typeof a.subscribe!="function")throw n===a?new TypeError("Given argument to useObservable() was neither a valid observable nor a function."):new TypeError("Observable factory given to useObservable() did not return a valid observable.");if(!l.current.hasResult&&typeof window<"u"&&(typeof a.hasValue!="function"||a.hasValue()))if(typeof a.getValue=="function")l.current.result=a.getValue(),l.current.hasResult=!0;else{var i=a.subscribe(function(o){l.current.result=o,l.current.hasResult=!0});typeof i=="function"?i():i.unsubscribe()}return a},h);if(v.useDebugValue(l.current.result),v.useEffect(function(){var a=g.subscribe(function(i){var o=l.current;(o.error!==null||o.result!==i)&&(o.error=null,o.result=i,o.hasResult=!0,j())},function(i){var o=l.current;o.error!==i&&(o.error=i,j())});return typeof a=="function"?a:a.unsubscribe.bind(a)},h),l.current.error)throw l.current.error;return l.current.result}function G(n,f,d){return Q(function(){return T(n)},f||[],d)}function Y(){const[n,f]=u.useState(""),[d,h]=u.useState("all"),[y,l]=u.useState(null),[N,j]=u.useState(!1),[g,a]=u.useState(!1),[i,o]=u.useState(null),R=30,x=G(()=>M.conversations.orderBy("sentAt").reverse().limit(100).toArray(),[],[]);u.useEffect(()=>{const t=window.matchMedia("(prefers-reduced-motion: reduce)");j(t.matches);const s=()=>j(t.matches);return t.addEventListener("change",s),()=>t.removeEventListener("change",s)},[]);const w=u.useMemo(()=>{let t=x;if(d!=="all"&&(t=t.filter(s=>s.platform===d)),n){const s=n.toLowerCase();t=t.filter(r=>r.pageName.toLowerCase().includes(s)||r.sentMessage.toLowerCase().includes(s))}return t},[x,d,n]),m=u.useMemo(()=>{if(!x.length)return null;const t=x.length,s={},r={sent:0,responded:0,no_response:0},p=x.filter(c=>Date.now()-c.sentAt<10080*60*1e3).length;x.forEach(c=>{s[c.platform]=(s[c.platform]||0)+1,r[c.status]=(r[c.status]||0)+1});const b=t>0?Math.round(r.responded/t*100):0;return{total:t,byPlatform:s,byStatus:r,last7Days:p,responseRate:b}},[x]),E=async t=>{await M.conversations.delete(t),o(null),l(null)},L=(t=>{const s={};return t.forEach(r=>{const p=new Date(r.sentAt).toLocaleDateString();s[p]||(s[p]=[]),s[p].push(r)}),s})(w),C=t=>{switch(t){case"x":return"X";case"linkedin":return"in";case"github":return"GH";default:return"W"}};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(P,{size:14,className:"absolute left-2.5 top-1/2 -translate-y-1/2 text-muted-foreground pointer-events-none"}),e.jsx(I,{placeholder:"Search...",size:"sm",value:n,onChange:t=>f(t.target.value),"aria-label":"Search conversations",className:"pl-8"})]}),m&&e.jsx("button",{onClick:()=>a(!g),className:`w-8 h-8 flex items-center justify-center rounded-lg border transition-colors ${g?"bg-primary text-primary-foreground border-primary":"bg-card text-muted-foreground border-border/60 hover:text-foreground"}`,"aria-label":"Toggle analytics","aria-pressed":g,children:e.jsx($,{size:14})})]}),g&&m&&e.jsxs(D,{variant:"default",children:[e.jsx(A,{children:e.jsx(V,{children:"Analytics"})}),e.jsxs(S,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"text-center p-2 rounded-lg bg-background/50",children:[e.jsx("p",{className:"text-lg font-bold tabular-nums text-foreground",children:m.total}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Total"})]}),e.jsxs("div",{className:"text-center p-2 rounded-lg bg-background/50",children:[e.jsx("p",{className:"text-lg font-bold tabular-nums text-foreground",children:m.last7Days}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"7 Days"})]}),e.jsxs("div",{className:"text-center p-2 rounded-lg bg-background/50",children:[e.jsxs("p",{className:"text-lg font-bold tabular-nums text-foreground",children:[m.responseRate,"%"]}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Replied"})]})]}),Object.keys(m.byPlatform).length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5 pt-3 mt-3 border-t border-border/40",children:Object.entries(m.byPlatform).map(([t,s])=>e.jsxs(z,{variant:"outline",size:"sm",children:[C(t)," ",s]},t))})]})]}),e.jsx("div",{className:"flex gap-1.5",children:["all","x","linkedin","github"].map(t=>e.jsx("button",{onClick:()=>h(t),className:`px-2.5 py-1 rounded-md text-[11px] font-medium transition-all ${d===t?"bg-primary text-primary-foreground":"bg-muted/50 text-muted-foreground hover:text-foreground"}`,"aria-pressed":d===t,children:t==="all"?"All":t.charAt(0).toUpperCase()+t.slice(1)},t))}),w.length===0?e.jsxs("div",{className:"py-10 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:n||d!=="all"?"No conversations match your search.":"No conversations yet."}),!n&&d==="all"&&e.jsx("p",{className:"text-[11px] text-muted-foreground/60 mt-1",children:"Copy and send a message to start tracking."})]}):Object.entries(L).map(([t,s])=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("p",{className:"text-[10px] font-medium uppercase tracking-wider text-muted-foreground/60 px-1 pt-1",children:t===new Date().toLocaleDateString()?"Today":t}),s.map(r=>{const p=w.findIndex(c=>c.id===r.id),b=y===r.id;return e.jsx(D,{variant:"default",className:`cursor-pointer transition-all ${b?"ring-1 ring-ring/30":""}`,style:N?{opacity:1}:{animation:`fade-in-up 200ms ${p*R}ms forwards`,opacity:0},onClick:()=>l(b?null:r.id),children:e.jsx(S,{className:"p-3",children:e.jsxs("div",{className:"flex items-start gap-2.5",children:[e.jsx("div",{className:"flex-shrink-0 w-7 h-7 rounded-md bg-muted/60 flex items-center justify-center text-[10px] font-semibold text-muted-foreground",children:C(r.platform)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("h4",{className:"text-[13px] font-medium text-foreground truncate",children:r.pageName}),e.jsx("span",{className:"text-[10px] text-muted-foreground/60 tabular-nums shrink-0",children:new Date(r.sentAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),!b&&e.jsx("p",{className:"text-xs text-muted-foreground truncate mt-0.5",children:r.sentMessage}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5",children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${r.status==="sent"?"bg-info":r.status==="responded"?"bg-success":"bg-muted-foreground"}`}),e.jsx("span",{className:"text-[10px] text-muted-foreground capitalize",children:r.status.replace("_"," ")}),e.jsx("span",{className:"text-[10px] text-muted-foreground/40",children:"Â·"}),e.jsx("span",{className:"text-[10px] text-muted-foreground/60 capitalize",children:r.angle})]}),b&&e.jsxs("div",{className:"mt-2.5 pt-2.5 border-t border-border/40",children:[e.jsx("p",{className:"text-[13px] leading-relaxed text-foreground/90 whitespace-pre-wrap",children:r.sentMessage}),e.jsx("div",{className:"flex items-center justify-end mt-2.5",children:e.jsxs("button",{onClick:c=>{c.stopPropagation(),o({id:r.id,name:r.pageName})},className:"flex items-center gap-1 text-[10px] text-destructive/70 hover:text-destructive transition-colors","aria-label":`Delete conversation with ${r.pageName}`,children:[e.jsx(B,{size:11}),"Delete"]})})]})]})]})})},r.id)})]},t)),i&&e.jsx(O,{title:"Delete Conversation?",description:`Delete the conversation with ${i.name}? This cannot be undone.`,confirmLabel:"Delete",onConfirm:()=>E(i.id),onClose:()=>o(null)})]})}export{Y as default};
