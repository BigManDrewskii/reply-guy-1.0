import{c as B,r as o,u as I,e as H,j as e}from"./sidepanel-DS6lTU98.js";import{d as O,s as F,A as z}from"./alert-Cs92dhMe.js";import{d as R,C as b,a as N,b as k,c as S,B as T}from"./badge-4w6LEc2_.js";import{B as w}from"./button-BEKyJbm1.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=B("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);function L(){const[f,i]=o.useState(1),[l,j]=o.useState(""),[m,p]=o.useState(null),[t,c]=o.useState(!1),[u,d]=o.useState({}),[P,x]=o.useState(null),g=I(r=>r.apiKey),v=l.split("---").map(r=>r.trim()).filter(r=>r.length>0).length,C=o.useCallback(async()=>{if(!g){x("No API key configured");return}if(v<5){x("Please provide at least 5 example messages");return}c(!0),x(null),d({});try{const r=O(l.split("---").map(s=>s.trim()).filter(s=>s.length>0));let h="";await F([{role:"system",content:"You are an expert at analyzing writing styles and voice patterns."},{role:"user",content:r}],g,{onChunk:s=>{h+=s;try{let a=h;const y=a.match(/```(?:json)?\s*([\s\S]*?)```/);y&&(a=y[1]);const n=JSON.parse(a);d({tone:n.tone,openingPatterns:n.openingPatterns,closingPatterns:n.closingPatterns,personalityMarkers:n.personalityMarkers,avoidPhrases:n.avoidPhrases,vocabularySignature:n.vocabularySignature})}catch{}},onComplete:async s=>{try{let a=s;const y=a.match(/```(?:json)?\s*([\s\S]*?)```/);y&&(a=y[1]);const n=JSON.parse(a),A={id:"default",tone:n.tone,openingPatterns:n.openingPatterns,closingPatterns:n.closingPatterns,personalityMarkers:n.personalityMarkers,avoidPhrases:n.avoidPhrases,vocabularySignature:n.vocabularySignature,exampleMessages:l.split("---").map(V=>V.trim()).filter(V=>V.length>0),lastUpdated:Date.now()};p(A),c(!1),i(3)}catch{x("Failed to parse voice analysis"),c(!1)}},onError:s=>{console.error("[useVoiceTraining] Voice extraction error:",{error:s,messageCount:v,timestamp:new Date().toISOString()}),x(s.message),c(!1)}})}catch(r){x(r instanceof Error?r.message:"Voice analysis failed"),c(!1)}},[g,l]),E=o.useCallback(async()=>{if(m)try{await R.voiceProfiles.put(m),chrome.storage.local.set({voiceProfile:m}),i(1),j(""),p(null),d({})}catch{x("Failed to save voice profile")}},[m]),M=o.useCallback(()=>{i(1),j(""),p(null),d({}),x(null)},[]);return{step:f,setStep:i,exampleMessages:l,setExampleMessages:j,messageCount:v,voiceProfile:m,isExtracting:t,extractionProgress:u,error:P,analyzeVoice:C,saveVoiceProfile:E,reset:M}}function q({onBack:f}){const{step:i,setStep:l,exampleMessages:j,setExampleMessages:m,messageCount:p,voiceProfile:t,isExtracting:c,extractionProgress:u,error:d,analyzeVoice:P,saveVoiceProfile:x,reset:g}=L(),{add:v}=H(),[C,E]=o.useState(!1);o.useEffect(()=>{chrome.storage.local.get("voiceProfile",s=>{s.voiceProfile&&E(!0)})},[]),o.useEffect(()=>{i===2&&!c&&!t&&!d&&P()},[i,c,t,d,P]),o.useEffect(()=>{i===2&&t&&!c&&l(3)},[i,t,c,l]);const M=async()=>{await x(),v({type:"success",message:"Voice profile saved"}),f&&f()},r=()=>{f&&(g(),f())},h=()=>e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("button",{onClick:r,className:"text-muted-foreground hover:text-foreground transition-colors p-1 -ml-1 rounded-md","aria-label":"Back to settings",children:e.jsx(D,{size:16})}),e.jsx("h2",{className:"text-sm font-semibold text-foreground",children:"Voice Training"})]});if(i===1)return e.jsxs("div",{className:"space-y-4",children:[e.jsx(h,{}),C&&e.jsx(z,{variant:"warning",children:"You already have a voice profile. Training a new one will replace it."}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-medium uppercase tracking-wider text-muted-foreground mb-1",children:"Step 1 of 3"}),e.jsx("p",{className:"text-[13px] text-foreground font-medium mb-1",children:"Add your messages"}),e.jsx("p",{className:"text-xs text-muted-foreground leading-relaxed",children:'Paste 10-20 example DMs. Separate each with "---".'})]}),e.jsx("textarea",{value:j,onChange:s=>m(s.target.value),placeholder:`Hey! Saw your post about...

---

That's really interesting. I've been...

---

Would love to chat more about...`,className:"w-full h-56 px-3 py-2.5 bg-background border border-border/60 rounded-lg text-[13px] leading-relaxed text-foreground placeholder-muted-foreground/50 focus:outline-none focus:ring-2 focus:ring-ring/40 focus:border-ring resize-none font-mono transition-colors"}),e.jsxs("div",{className:"flex items-center justify-between text-[11px] text-muted-foreground",children:[e.jsxs("span",{className:"tabular-nums",children:[p," message",p!==1?"s":""]}),e.jsx("span",{children:"Min 5 Â· Best 10-20"})]}),d&&e.jsx("p",{className:"text-[11px] text-destructive",children:d}),e.jsx(w,{onClick:()=>l(2),disabled:p<5,variant:"primary",size:"md",className:"w-full",children:"Analyze My Voice"})]});if(i===2){const s=[{key:"tone",label:"Tone detected",done:u.tone!==void 0},{key:"opening",label:"Opening patterns",done:!!u.openingPatterns},{key:"closing",label:"Closing patterns",done:!!u.closingPatterns},{key:"personality",label:"Personality markers",done:!!u.personalityMarkers},{key:"avoid",label:"Avoidances",done:!!u.avoidPhrases},{key:"vocab",label:"Vocabulary signature",done:!!u.vocabularySignature}];return e.jsxs("div",{className:"space-y-4",children:[e.jsx(h,{}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-medium uppercase tracking-wider text-muted-foreground mb-1",children:"Step 2 of 3"}),e.jsx("p",{className:"text-[13px] text-foreground font-medium mb-1",children:"Analyzing your voice"}),e.jsx("p",{className:"text-xs text-muted-foreground leading-relaxed",children:"Extracting your unique writing style..."})]}),c&&e.jsx(b,{variant:"default",children:e.jsx(N,{className:"p-3 space-y-2",children:s.map(a=>e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:`w-1.5 h-1.5 rounded-full transition-colors duration-300 ${a.done?"bg-success":"bg-muted animate-pulse"}`}),e.jsx("span",{className:`text-xs transition-colors duration-300 ${a.done?"text-foreground":"text-muted-foreground"}`,children:a.label})]},a.key))})}),d&&e.jsx(z,{variant:"error",action:{label:"Go back",onClick:()=>l(1)},children:d}),e.jsx(w,{onClick:()=>{g(),l(1)},variant:"ghost",size:"sm",className:"w-full",children:"Cancel"})]})}return i===3&&t?e.jsxs("div",{className:"space-y-4",children:[e.jsx(h,{}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-medium uppercase tracking-wider text-muted-foreground mb-1",children:"Step 3 of 3"}),e.jsx("p",{className:"text-[13px] text-foreground font-medium mb-1",children:"Review your profile"}),e.jsx("p",{className:"text-xs text-muted-foreground leading-relaxed",children:"Check your voice fingerprint before saving."})]}),e.jsxs(b,{variant:"default",children:[e.jsx(k,{children:e.jsx(S,{children:"Tone"})}),e.jsxs(N,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-1 h-1.5 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary rounded-full transition-all",style:{width:`${t.tone/10*100}%`}})}),e.jsxs("span",{className:"text-xs tabular-nums text-foreground font-medium w-8 text-right",children:[t.tone,"/10"]})]}),e.jsx("p",{className:"text-[11px] text-muted-foreground mt-1.5",children:t.tone<=3?"Formal & Professional":t.tone<=7?"Balanced":"Casual & Friendly"})]})]}),e.jsxs(b,{variant:"default",children:[e.jsx(k,{children:e.jsx(S,{children:"Opening Patterns"})}),e.jsx(N,{children:e.jsx("div",{className:"space-y-1",children:t.openingPatterns.map((s,a)=>e.jsxs("p",{className:"text-xs text-muted-foreground font-mono",children:['"',s,'"']},a))})})]}),e.jsxs(b,{variant:"default",children:[e.jsx(k,{children:e.jsx(S,{children:"Personality"})}),e.jsx(N,{children:e.jsx("div",{className:"flex flex-wrap gap-1.5",children:t.personalityMarkers.map((s,a)=>e.jsx(T,{variant:"outline",size:"sm",children:s},a))})})]}),e.jsxs(b,{variant:"default",children:[e.jsx(k,{children:e.jsx(S,{children:"Vocabulary"})}),e.jsx(N,{children:e.jsx("div",{className:"flex flex-wrap gap-1.5",children:t.vocabularySignature.map((s,a)=>e.jsx(T,{variant:"info",size:"sm",children:s},a))})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{onClick:()=>l(1),variant:"ghost",size:"sm",className:"flex-1",children:"Redo"}),e.jsx(w,{onClick:M,variant:"primary",size:"sm",className:"flex-1",children:"Save Profile"})]})]}):null}export{q as default};
