import{c as V,r as n,j as e,C as te,a as L,b as B,u as W,R as ne,P as re,Z as ae}from"./sidepanel-DS6lTU98.js";import{P as H}from"./icons-BixTLACo.js";import{C as T,a as M,b as $,c as P,B as _,d as q}from"./badge-4w6LEc2_.js";import{L as le,B as D}from"./button-BEKyJbm1.js";import{E as oe}from"./external-link-Dm5ibOKQ.js";import{g as ie,s as Y,e as O,a as ce,b as de,c as ue,A as J}from"./alert-Cs92dhMe.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=V("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=V("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=V("OctagonAlert",[["path",{d:"M12 16h.01",key:"1drbdi"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M15.312 2a2 2 0 0 1 1.414.586l4.688 4.688A2 2 0 0 1 22 8.688v6.624a2 2 0 0 1-.586 1.414l-4.688 4.688a2 2 0 0 1-1.414.586H8.688a2 2 0 0 1-1.414-.586l-4.688-4.688A2 2 0 0 1 2 15.312V8.688a2 2 0 0 1 .586-1.414l4.688-4.688A2 2 0 0 1 8.688 2z",key:"1fd625"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=V("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);function he(s){let t=0;for(let l=0;l<s.length;l++)t=s.charCodeAt(l)+((t<<5)-t);const r=Math.abs(t%360),a=(r+40)%360;return`linear-gradient(135deg, oklch(0.55 0.15 ${r}), oklch(0.45 0.18 ${a}))`}const U=n.forwardRef(({className:s,src:t,alt:r,fallback:a,size:l="md",variant:o="circle",status:x,loading:p=!1,error:c=!1,...i},m)=>{const[C,N]=n.useState(!1),u={xs:"w-5 h-5 text-[9px]",sm:"w-8 h-8 text-xs",md:"w-10 h-10 text-sm",lg:"w-12 h-12 text-base",xl:"w-16 h-16 text-lg"},g={xs:10,sm:12,md:14,lg:16,xl:18}[l],d={online:"var(--color-success)",offline:"var(--color-muted-foreground)",away:"var(--color-warning)",busy:"var(--color-destructive)"},w=c||C,j=w||!t,A=n.useMemo(()=>he(a||r||"?"),[a,r]);return e.jsxs("div",{ref:m,className:L("relative inline-flex flex-shrink-0",u[l],s),...i,children:[e.jsxs("div",{className:L("relative w-full h-full inline-flex items-center justify-center overflow-hidden","font-semibold text-white",{"rounded-full":o==="circle","rounded-lg":o==="square"}),style:j?{background:A}:void 0,children:[p&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-card/50 backdrop-blur-sm z-10",children:e.jsx(le,{size:g,className:"animate-spin text-muted-foreground"})}),j?w&&!a?e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-destructive/10",children:e.jsx(te,{size:g,className:"text-destructive"})}):e.jsx("span",{className:"select-none","aria-label":r||a||"Avatar",children:a}):e.jsx("img",{src:t,alt:r||"",className:"w-full h-full object-cover",onError:()=>N(!0)})]}),x&&e.jsx("span",{className:L("absolute bottom-0 right-0 block rounded-full ring-2 ring-background",{"h-1.5 w-1.5":l==="xs"||l==="sm","h-2.5 w-2.5":l==="md"||l==="lg","h-3 w-3":l==="xl"}),style:{backgroundColor:d[x]},role:"status","aria-label":`Status: ${x}`})]})});U.displayName="Avatar";function pe({data:s}){var r,a;const t=H[s.platform]||H.generic;return e.jsx(T,{variant:"default",children:e.jsxs(M,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(U,{src:s.avatarUrl,fallback:((r=s.name)==null?void 0:r.charAt(0).toUpperCase())||((a=s.ogTitle)==null?void 0:a.charAt(0).toUpperCase())||"?",size:"lg",variant:"circle"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("h2",{className:"text-[15px] font-semibold text-foreground truncate",children:s.name||s.ogTitle||s.title}),e.jsx(t,{size:14,className:"text-muted-foreground shrink-0"})]}),(s.location||s.company)&&e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5 truncate",children:[s.location,s.company].filter(Boolean).join(" Â· ")}),s.headline&&e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5 line-clamp-1",children:s.headline})]})]}),s.bio&&e.jsx("p",{className:"text-[13px] leading-relaxed text-muted-foreground line-clamp-3 mb-3",children:s.bio}),s.about&&!s.bio&&e.jsx("p",{className:"text-[13px] leading-relaxed text-muted-foreground line-clamp-3 mb-3",children:s.about}),s.followers&&e.jsx("div",{className:"flex items-center gap-3 text-xs text-muted-foreground pb-3 mb-3 border-b border-border/60",children:e.jsxs("span",{children:[e.jsx("span",{className:"text-foreground font-medium",children:s.followers})," followers"]})}),s.recentPosts&&s.recentPosts.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-medium text-muted-foreground uppercase tracking-wide mb-2",children:"Recent posts"}),e.jsx("div",{className:"space-y-1.5",children:s.recentPosts.slice(0,3).map((l,o)=>e.jsx("p",{className:"text-xs text-muted-foreground/80 line-clamp-2 leading-relaxed",children:l},o))})]})]})})}const be=n.memo(pe,(s,t)=>s.data.name===t.data.name&&s.data.headline===t.data.headline&&s.data.bio===t.data.bio);function je({data:s}){return e.jsx(T,{variant:"default",children:e.jsxs(M,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx(U,{fallback:e.jsx(fe,{size:20}),size:"md",variant:"circle"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h2",{className:"text-base font-semibold text-foreground truncate",children:s.hostname}),s.ogTitle&&e.jsx("p",{className:"text-sm text-muted-foreground mt-0.5 line-clamp-2",children:s.ogTitle}),!s.ogTitle&&s.h1&&e.jsx("p",{className:"text-sm text-muted-foreground mt-0.5 line-clamp-2",children:s.h1})]})]}),s.ogDescription&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-3 mb-3",children:s.ogDescription}),s.socialLinks&&s.socialLinks.length>0&&e.jsxs("div",{className:"border-t border-border pt-3 mt-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Detected social links"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.socialLinks.map((t,r)=>e.jsxs("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-primary hover:underline inline-flex items-center gap-1",children:[new URL(t).hostname,e.jsx(oe,{size:12})]},r))})]}),s.email&&e.jsxs("div",{className:"border-t border-border pt-3 mt-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Contact"}),e.jsx("a",{href:`mailto:${s.email}`,className:"text-sm text-primary hover:underline",children:s.email})]})]})})}const ve=n.memo(je,(s,t)=>s.data.hostname===t.data.hostname&&s.data.ogTitle===t.data.ogTitle&&s.data.ogDescription===t.data.ogDescription);function ye({text:s,onCopy:t}){const[r,a]=n.useState(!1),l=async()=>{try{await navigator.clipboard.writeText(s),a(!0),t&&t(),setTimeout(()=>a(!1),1500)}catch(o){console.error("Failed to copy:",o)}};return e.jsx(D,{variant:r?"success":"primary",onClick:l,"aria-label":r?"Copied!":"Copy to clipboard",size:"md",className:"w-full",children:r?e.jsxs(e.Fragment,{children:[e.jsx(B,{size:15}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(me,{size:15}),"Copy Message"]})})}const Ne=n.memo(ye,(s,t)=>s.text===t.text);function we({initialMessage:s,onSave:t,onClose:r}){const[a,l]=n.useState(s),o=n.useRef(null),x=a.split(/\s+/).filter(Boolean).length,p=!a.trim()||a===s;return n.useEffect(()=>{o.current&&(o.current.focus(),o.current.setSelectionRange(a.length,a.length));const c=i=>{i.key==="Escape"&&r()};return document.addEventListener("keydown",c),()=>document.removeEventListener("keydown",c)},[]),e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm flex items-end justify-center z-50 animate-fade-in",onClick:r,role:"dialog","aria-modal":"true","aria-label":"Edit message",children:e.jsxs("div",{className:"w-full bg-card border-t border-border/60 rounded-t-2xl animate-slide-up",onClick:c=>c.stopPropagation(),children:[e.jsx("div",{className:"w-8 h-1 bg-muted-foreground/20 rounded-full mx-auto mt-3 mb-2"}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:"Edit Message"}),e.jsxs("span",{className:"text-[10px] text-muted-foreground tabular-nums",children:[x,"w"]})]}),e.jsx("textarea",{ref:o,value:a,onChange:c=>l(c.target.value),className:"w-full h-40 px-3 py-2.5 rounded-lg bg-background border border-border/60 text-[13px] text-foreground leading-relaxed resize-none focus:outline-none focus:ring-2 focus:ring-ring/40 focus:border-ring transition-colors",placeholder:"Edit your message...","aria-label":"Edit message content"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(D,{onClick:r,variant:"ghost",size:"sm",className:"flex-1",children:"Cancel"}),e.jsxs(D,{onClick:()=>t(a),variant:"primary",size:"sm",className:"flex-1",disabled:p,children:[e.jsx(B,{size:13}),"Save"]})]})]})]})})}function Ce(){const[s,t]=n.useState({}),[r,a]=n.useState({}),[l,o]=n.useState("service"),[x,p]=n.useState(null),[c,i]=n.useState(0),m=W(f=>f.apiKey),C=n.useRef(null),N=n.useRef(null),u=n.useRef(null),g=n.useRef(null),d=3;n.useEffect(()=>{const f=()=>{chrome.storage.local.get("voiceProfile",h=>{h.voiceProfile&&p(h.voiceProfile)})};f();const k=()=>f();return chrome.storage.onChanged.addListener(k),()=>chrome.storage.onChanged.removeListener(k)},[]);const w=n.useCallback(()=>{g.current&&(g.current.abort(),g.current=null)},[]),j=n.useCallback(async(f,k,h)=>{if(!m)return;C.current=f,N.current=k,u.current=h,w();const z=new AbortController;g.current=z,a(S=>({...S,[h]:!0}));try{const S=ie(f,k,h,x||void 0);let E="";await Y([{role:"system",content:"You are a helpful assistant that generates personalized outreach messages."},{role:"user",content:S}],m,{signal:z.signal,onChunk:R=>{E+=R;try{const b=O(E),v=JSON.parse(b);v.message&&t(y=>({...y,[h]:v}))}catch{}},onComplete:R=>{try{const b=O(R),v=JSON.parse(b);t(y=>({...y,[h]:v})),a(y=>({...y,[h]:!1})),i(0)}catch{a(b=>({...b,[h]:!1}))}g.current=null},onError:R=>{if(R instanceof DOMException&&R.name==="AbortError"){a(y=>({...y,[h]:!1}));return}const b=R instanceof Error?R.message:"Generation failed";if((b.includes("network")||b.includes("timeout")||b.includes("503")||b.includes("502"))&&c<d){i(I=>I+1);const y=Math.pow(2,c)*1e3;setTimeout(()=>{C.current&&N.current&&u.current&&j(C.current,N.current,u.current)},y)}else a(y=>({...y,[h]:!1})),i(0);g.current=null}})}catch(S){if(S instanceof DOMException&&S.name==="AbortError"){a(E=>({...E,[h]:!1}));return}a(E=>({...E,[h]:!1})),g.current=null}},[m,x,c,w]),A=n.useCallback(async(f,k,h)=>{t(z=>({...z,[h]:null})),await j(f,k,h)},[j]);return{messages:s,isGenerating:r,selectedAngle:l,setSelectedAngle:o,generateMessage:j,regenerateMessage:A,cancelGeneration:w,setMessages:t}}const K=n.createContext(void 0),F=n.forwardRef(({defaultValue:s,value:t,onValueChange:r,children:a,className:l},o)=>{const[x,p]=n.useState(s),c=t??x,i=m=>{t===void 0&&p(m),r==null||r(m)};return e.jsx(K.Provider,{value:{value:c,onValueChange:i},children:e.jsx("div",{ref:o,className:l,children:a})})});F.displayName="TabsRoot";const X=n.forwardRef(({children:s,className:t},r)=>e.jsx("div",{ref:r,role:"tablist","aria-orientation":"horizontal",className:L("inline-flex w-full items-center gap-0.5 rounded-lg bg-muted/40 p-0.5",t),children:s}));X.displayName="TabsList";const Z=n.forwardRef(({value:s,children:t,disabled:r=!1,className:a},l)=>{const o=n.useContext(K);if(!o)throw new Error("TabsTrigger must be used within TabsRoot");const{value:x,onValueChange:p}=o,c=x===s;return e.jsx("button",{ref:l,type:"button",disabled:r,role:"tab","aria-selected":c,"aria-controls":`panel-${s}`,id:`tab-${s}`,tabIndex:c?0:-1,onClick:()=>!r&&p(s),onKeyDown:i=>{var N,u,g,d,w,j,A;const m=Array.from(((N=i.currentTarget.parentElement)==null?void 0:N.querySelectorAll('[role="tab"]'))||[]),C=m.indexOf(i.currentTarget);switch(i.key){case"ArrowLeft":case"ArrowRight":i.preventDefault();const f=i.key==="ArrowLeft"?-1:1,k=(C+f+m.length)%m.length;(u=m[k])==null||u.focus(),(g=m[k])==null||g.click();break;case"Home":i.preventDefault(),(d=m[0])==null||d.focus(),(w=m[0])==null||w.click();break;case"End":i.preventDefault(),(j=m[m.length-1])==null||j.focus(),(A=m[m.length-1])==null||A.click();break;case"Enter":case" ":i.preventDefault(),i.currentTarget.click();break}},className:L("relative flex-1 px-3 py-1.5 rounded-md text-xs font-medium transition-all duration-150 ease-in-out","focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-1 focus-visible:ring-offset-background","disabled:opacity-50 disabled:cursor-not-allowed",{"bg-card text-foreground shadow-xs":c,"text-muted-foreground hover:text-foreground":!c},a),children:t})});Z.displayName="TabsTrigger";const Q=n.forwardRef(({value:s,children:t,className:r},a)=>{const l=n.useContext(K);if(!l)throw new Error("TabsContent must be used within TabsRoot");const{value:o}=l;return o===s?e.jsx("div",{ref:a,role:"tabpanel",id:`panel-${s}`,"aria-labelledby":`tab-${s}`,tabIndex:0,className:r,children:t}):null});Q.displayName="TabsContent";const G=Object.assign(F,{Root:F,List:X,Trigger:Z,Content:Q});function ke(s){return s>=80?{label:"Sounds like you",variant:"success"}:s>=60?{label:"Close match",variant:"info"}:s>=40?{label:"Moderate match",variant:"warning"}:{label:"Generic tone",variant:"error"}}function Se({pageData:s,analysis:t,selectedAngle:r,onSelectAngle:a,onCopy:l,onRegenerate:o}){const{messages:x,isGenerating:p,generateMessage:c,regenerateMessage:i,setMessages:m}=Ce(),[C,N]=n.useState(!1),u=x[r],g=p[r],d=f=>{a(f),!x[f]&&!p[f]&&c(s,t,f)},w=()=>{i(s,t,r),o&&o()},j=()=>{l&&u&&l(u.message)};!u&&!g&&t&&c(s,t,r);const A=u?ke(u.voiceScore):null;return e.jsxs(T,{variant:"default",children:[e.jsx($,{children:e.jsx(P,{children:"Message"})}),e.jsxs(M,{className:"space-y-3",children:[(t==null?void 0:t.outreachAngles)&&e.jsx(G.Root,{defaultValue:r,value:r,onValueChange:d,children:e.jsx(G.List,{children:t.outreachAngles.map(f=>e.jsx(G.Trigger,{value:f.angle,children:f.angle.charAt(0).toUpperCase()+f.angle.slice(1)},f.angle))})}),g&&!u&&e.jsxs("div",{role:"status","aria-live":"polite","aria-label":"Generating message",className:"space-y-2.5 py-3",children:[e.jsx("div",{className:"h-2.5 bg-muted rounded-full w-full animate-pulse"}),e.jsx("div",{className:"h-2.5 bg-muted rounded-full w-5/6 animate-pulse"}),e.jsx("div",{className:"h-2.5 bg-muted rounded-full w-4/6 animate-pulse"}),e.jsx("div",{className:"h-2.5 bg-muted rounded-full w-full animate-pulse"}),e.jsx("div",{className:"h-2.5 bg-muted rounded-full w-3/5 animate-pulse"})]}),u&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-lg bg-background/50 p-3",children:e.jsx("p",{className:"text-[13px] text-foreground whitespace-pre-wrap leading-relaxed",children:u.message})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[A&&e.jsx(_,{variant:A.variant,size:"sm",children:A.label}),e.jsxs("span",{className:"text-[10px] text-muted-foreground font-numerical tabular-nums",children:[u.voiceScore,"%"]})]}),e.jsxs("span",{className:"text-[10px] text-muted-foreground font-numerical tabular-nums",children:[u.wordCount,"w"]})]}),u.hook&&e.jsxs("p",{className:"text-[11px] text-muted-foreground/70 italic leading-relaxed",children:["Hook: ",u.hook]}),e.jsx(Ne,{text:u.message,onCopy:j}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(D,{variant:"ghost",size:"sm",onClick:w,disabled:g,className:"flex-1",children:[e.jsx(ne,{size:13,className:g?"animate-spin":""}),"Regenerate"]}),e.jsxs(D,{variant:"ghost",size:"sm",onClick:()=>N(!0),className:"flex-1","aria-label":"Edit this message",children:[e.jsx(ge,{size:13}),"Edit"]})]})]})]}),C&&u&&e.jsx(we,{initialMessage:u.message,onSave:f=>{m(k=>({...k,[r]:{...u,message:f,wordCount:f.split(/\s+/).filter(Boolean).length}})),N(!1)},onClose:()=>N(!1)})]})}const Ae=n.memo(Se,(s,t)=>{var r,a,l,o,x,p,c,i;return s.pageData.url===t.pageData.url&&s.selectedAngle===t.selectedAngle&&((r=s.analysis)==null?void 0:r.personName)===((a=t.analysis)==null?void 0:a.personName)&&((l=s.analysis)==null?void 0:l.confidence)===((o=t.analysis)==null?void 0:o.confidence)&&((p=(x=s.analysis)==null?void 0:x.outreachAngles)==null?void 0:p.length)===((i=(c=t.analysis)==null?void 0:c.outreachAngles)==null?void 0:i.length)});function Re({isOpen:s,onClose:t,onLogged:r}){const[a,l]=n.useState(!1);n.useEffect(()=>{s&&l(!0)},[s]);const o=n.useCallback(c=>{s&&(c.key==="Escape"?p():c.key==="Enter"&&x())},[s]);if(n.useEffect(()=>(document.addEventListener("keydown",o),()=>document.removeEventListener("keydown",o)),[o]),!s)return null;const x=()=>{r(),l(!1),setTimeout(()=>t(),200)},p=()=>{l(!1),setTimeout(()=>t(),200)};return e.jsx("div",{className:`
        fixed inset-0 bg-background/60 backdrop-blur-sm flex items-end justify-center z-50
        transition-opacity duration-200
        ${a?"opacity-100":"opacity-0"}
      `,onClick:p,role:"dialog","aria-modal":"true","aria-label":"Log conversation",children:e.jsxs("div",{className:`
          w-full bg-card border-t border-border/60 rounded-t-2xl p-5 pb-6
          transition-transform duration-200 ease-out
          ${a?"translate-y-0":"translate-y-full"}
        `,onClick:c=>c.stopPropagation(),children:[e.jsx("div",{className:"w-8 h-1 bg-muted-foreground/20 rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-sm font-medium text-foreground text-center mb-1",children:"Message copied"}),e.jsx("p",{className:"text-[11px] text-muted-foreground text-center mb-5",children:"Did you send it? We'll track it for you."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(D,{onClick:x,variant:"primary",size:"md",className:"flex-1",children:[e.jsx(B,{size:14}),"Sent it"]}),e.jsx(D,{onClick:p,variant:"ghost",size:"md",className:"flex-1",children:"Not yet"})]})]})})}function Ee({value:s,max:t=100,size:r="md",variant:a,showValue:l=!1,label:o,color:x,className:p,...c}){const i=Math.min(Math.max(s/t*100,0),100),m=a||(i>=60?"success":i>=30?"warning":"error"),C={default:"bg-muted-foreground",success:"bg-success",warning:"bg-warning",error:"bg-destructive"},N={default:"text-muted-foreground",success:"text-success",warning:"text-warning",error:"text-destructive"};return e.jsxs("div",{className:L("space-y-2",p),...c,children:[(o||l)&&e.jsxs("div",{className:"flex items-center justify-between",children:[o&&e.jsx("span",{className:"text-xs text-muted-foreground font-medium",children:o}),l&&e.jsxs("span",{className:L("text-xs font-semibold font-numerical tabular-nums",N[m]),children:[Math.round(i),"%"]})]}),e.jsx("div",{role:"progressbar","aria-valuenow":Math.round(i),"aria-valuemin":0,"aria-valuemax":100,className:L("w-full bg-muted rounded-full overflow-hidden",{"h-1":r==="sm","h-1.5":r==="md","h-2":r==="lg"}),children:e.jsx("div",{className:L("h-full rounded-full transition-all duration-500",x?"":C[m]),style:{width:`${i}%`,transitionTimingFunction:"cubic-bezier(0.4, 0.0, 0.2, 1)",...x&&{backgroundColor:x}}})})]})}function ze(){const[s,t]=n.useState(null),[r,a]=n.useState(!1),[l,o]=n.useState(!1),[x,p]=n.useState(0),[c,i]=n.useState(null),[m,C]=n.useState(0),N=W(h=>h.apiKey),u=n.useRef(null),g=n.useRef(null),d=n.useRef(null),w=n.useRef(null),j=n.useRef(null),A=3,f=n.useCallback(()=>{j.current&&(j.current.abort(),j.current=null),u.current&&(clearTimeout(u.current),u.current=null),g.current&&(clearInterval(g.current),g.current=null),o(!1),p(0),a(!1),d.current=null},[]),k=n.useCallback(async h=>{if(!N){i("No API key configured");return}if(d.current===h.url&&(r||l))return;f(),d.current=h.url,w.current=h,o(!0),p(1),i(null);let z=1;g.current=setInterval(()=>{z--,p(z),z<=0&&g.current&&(clearInterval(g.current),g.current=null)},1e3),u.current=setTimeout(async()=>{o(!1),a(!0),t(null);try{const S=await ce(h.url);if(S){t(S),a(!1),d.current=null;return}const E=new AbortController;j.current=E;const R=de(h);let b="";await Y([{role:"system",content:"You are a helpful assistant that analyzes webpages for outreach purposes."},{role:"user",content:R}],N,{signal:E.signal,onChunk:v=>{b+=v;try{const y=O(b),I=JSON.parse(y);I.confidence&&t(I)}catch{}},onComplete:async v=>{try{const y=O(v),I=JSON.parse(y);t(I),await ue(h.url,I),C(0)}catch{i("Failed to parse analysis response")}a(!1),d.current=null,j.current=null},onError:v=>{if(v instanceof DOMException&&v.name==="AbortError")return;const y=v instanceof Error?v.message:"Analysis failed";if((y.includes("network")||y.includes("timeout")||y.includes("503")||y.includes("502"))&&m<A){C(se=>se+1);const ee=Math.pow(2,m)*1e3;setTimeout(()=>{w.current&&k(w.current)},ee)}else i(y),a(!1),d.current=null,j.current=null,C(0)}})}catch(S){if(S instanceof DOMException&&S.name==="AbortError")return;i(S instanceof Error?S.message:"Analysis failed"),a(!1),d.current=null,j.current=null}},1e3)},[N,r,l,f,m]);return{analysis:s,isAnalyzing:r,isDebouncing:l,debounceCountdown:x,error:c,analyzePage:k,cancelAnalysis:f}}function Pe({initialData:s}){const[t,r]=n.useState(s),[a,l]=n.useState(!s),[o,x]=n.useState("service"),[p,c]=n.useState(!1),[i,m]=n.useState(!1),[C,N]=n.useState(""),[u,g]=n.useState(null),{analysis:d,isAnalyzing:w,isDebouncing:j,debounceCountdown:A,error:f,analyzePage:k,cancelAnalysis:h}=ze();n.useEffect(()=>{const b=v=>{if(v.currentPageData){const y=v.currentPageData.newValue;r(y),l(!1),m(!1),g(null)}};return chrome.storage.session.onChanged.addListener(b),()=>chrome.storage.session.onChanged.removeListener(b)},[]),n.useEffect(()=>{(async()=>{if(t!=null&&t.url)try{const v=await q.conversations.where("pageUrl").equals(t.url).count();v>0?g(`You've already sent ${v} message${v>1?"s":""} to this page.`):g(null)}catch{}})()},[t==null?void 0:t.url]);const z=()=>{t&&!d&&!w&&!i&&(m(!0),k(t))},S=b=>{b&&N(b),setTimeout(()=>c(!0),100)},E=async()=>{if(!(!t||!C))try{await q.conversations.add({id:`${Date.now()}-${Math.random().toString(36).slice(2,9)}`,platform:t.platform,pageUrl:t.url,pageName:(d==null?void 0:d.personName)||t.name||t.ogTitle||t.hostname,sentMessage:C,angle:o,sentAt:Date.now(),status:"sent"})}catch(b){console.error("[OutreachScreen] Failed to log conversation:",b)}};if(a)return e.jsxs("div",{className:"space-y-3",children:[e.jsx(re,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-3 bg-muted rounded w-1/4"}),e.jsx("div",{className:"h-3 bg-muted rounded w-full"}),e.jsx("div",{className:"h-3 bg-muted rounded w-5/6"})]})]});if(!t)return e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-[13px] leading-relaxed text-muted-foreground",children:"Waiting for page data..."})});const R=t.isProfile||t.name;return e.jsxs("div",{className:"space-y-3",children:[R?e.jsx(be,{data:t}):e.jsx(ve,{data:t}),u&&e.jsx(J,{variant:"warning",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{size:14,className:"shrink-0"}),e.jsx("span",{children:u})]})}),f&&e.jsx(J,{variant:"error",children:f}),t&&!d&&!w&&!j&&!i&&e.jsx(T,{variant:"default",children:e.jsxs(M,{className:"p-5 text-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center mx-auto mb-3",children:e.jsx(ae,{size:18,className:"text-primary"})}),e.jsx("p",{className:"text-sm font-medium text-foreground mb-1",children:"Ready to analyze"}),e.jsxs("p",{className:"text-xs text-muted-foreground mb-4",children:["Generate personalized outreach for"," ",e.jsx("span",{className:"text-foreground font-medium",children:t.name||t.ogTitle||t.hostname})]}),e.jsx(D,{onClick:z,variant:"primary",size:"md",className:"w-full",children:"Analyze This Page"})]})}),j&&e.jsx(T,{variant:"default",children:e.jsxs(M,{className:"p-4 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-info animate-pulse"}),e.jsx("span",{className:"text-xs font-medium text-foreground",children:"Starting analysis..."})]}),e.jsxs("p",{className:"text-[11px] text-muted-foreground",children:["Analyzing in ",A,"s"]}),e.jsx(D,{onClick:h,variant:"ghost",size:"xs",className:"mt-2",children:"Cancel"})]})}),w&&!d&&e.jsx(T,{variant:"default",children:e.jsxs(M,{className:"p-4 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-info animate-pulse"}),e.jsx("span",{className:"text-xs font-medium text-foreground",children:"Analyzing page..."})]}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("div",{className:"h-2 bg-muted rounded-full w-full animate-pulse"}),e.jsx("div",{className:"h-2 bg-muted rounded-full w-3/4 animate-pulse"})]})]})}),d&&e.jsxs(e.Fragment,{children:[e.jsxs(T,{variant:"default",children:[e.jsx($,{children:e.jsx(P,{children:"Confidence"})}),e.jsxs(M,{children:[e.jsx(Ee,{value:d.confidence,showValue:!0,size:"md"}),d.confidenceReason&&e.jsx("p",{className:"text-[11px] leading-relaxed text-muted-foreground mt-2",children:d.confidenceReason})]})]}),d.summary&&e.jsxs(T,{variant:"default",children:[e.jsx($,{children:e.jsx(P,{children:"Summary"})}),e.jsx(M,{children:e.jsx("p",{className:"text-[13px] leading-relaxed text-muted-foreground",children:d.summary})})]}),d.interests&&d.interests.length>0&&e.jsxs(T,{variant:"default",children:[e.jsx($,{children:e.jsx(P,{children:"Interests"})}),e.jsx(M,{children:e.jsx("div",{className:"flex flex-wrap gap-1.5",children:d.interests.map((b,v)=>e.jsx(_,{variant:"outline",size:"sm",children:b},v))})})]})]}),d&&t&&e.jsx(Ae,{pageData:t,analysis:d,selectedAngle:o,onSelectAngle:x,onCopy:S}),e.jsx(Re,{isOpen:p,onClose:()=>c(!1),onLogged:E})]})}export{Pe as default};
