import{c as A,r as n,u as B,e as O,j as e}from"./sidepanel-D7LXy8vl.js";import{d as I,s as R,A as M}from"./alert-TLlvY9X7.js";import{d as Y,B as g}from"./badge-D08nYiI0.js";import{C as P,a as k}from"./card-Cy_DCTpp.js";import{B as S}from"./button-nkOSNevf.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=A("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);function F(){const[h,i]=n.useState(1),[l,j]=n.useState(""),[f,p]=n.useState(null),[t,c]=n.useState(!1),[x,d]=n.useState({}),[b,m]=n.useState(null),v=B(s=>s.apiKey),y=l.split("---").map(s=>s.trim()).filter(s=>s.length>0).length,C=n.useCallback(async()=>{if(!v){m("No API key configured");return}if(y<5){m("Please provide at least 5 example messages");return}c(!0),m(null),d({});try{const s=I(l.split("---").map(a=>a.trim()).filter(a=>a.length>0));let o="";await R([{role:"system",content:"You are an expert at analyzing writing styles and voice patterns."},{role:"user",content:s}],v,{onChunk:a=>{o+=a;try{let u=o;const N=u.match(/```(?:json)?\s*([\s\S]*?)```/);N&&(u=N[1]);const r=JSON.parse(u);d({tone:r.tone,openingPatterns:r.openingPatterns,closingPatterns:r.closingPatterns,personalityMarkers:r.personalityMarkers,avoidPhrases:r.avoidPhrases,vocabularySignature:r.vocabularySignature})}catch{}},onComplete:async a=>{try{let u=a;const N=u.match(/```(?:json)?\s*([\s\S]*?)```/);N&&(u=N[1]);const r=JSON.parse(u),T={id:"default",tone:r.tone,openingPatterns:r.openingPatterns,closingPatterns:r.closingPatterns,personalityMarkers:r.personalityMarkers,avoidPhrases:r.avoidPhrases,vocabularySignature:r.vocabularySignature,exampleMessages:l.split("---").map(V=>V.trim()).filter(V=>V.length>0),lastUpdated:Date.now()};p(T),c(!1),i(3)}catch{m("Failed to parse voice analysis"),c(!1)}},onError:a=>{console.error("[useVoiceTraining] Voice extraction error:",{error:a,messageCount:y,timestamp:new Date().toISOString()}),m(a.message),c(!1)}})}catch(s){m(s instanceof Error?s.message:"Voice analysis failed"),c(!1)}},[v,l]),w=n.useCallback(async()=>{if(f)try{await Y.voiceProfiles.put(f),chrome.storage.local.set({voiceProfile:f}),i(1),j(""),p(null),d({})}catch{m("Failed to save voice profile")}},[f]),z=n.useCallback(()=>{i(1),j(""),p(null),d({}),m(null)},[]);return{step:h,setStep:i,exampleMessages:l,setExampleMessages:j,messageCount:y,voiceProfile:f,isExtracting:t,extractionProgress:x,error:b,analyzeVoice:C,saveVoiceProfile:w,reset:z}}function q({onBack:h}){const{step:i,setStep:l,exampleMessages:j,setExampleMessages:f,messageCount:p,voiceProfile:t,isExtracting:c,extractionProgress:x,error:d,analyzeVoice:b,saveVoiceProfile:m,reset:v}=F(),{add:y}=O(),[C,w]=n.useState(!1);n.useEffect(()=>{chrome.storage.local.get("voiceProfile",o=>{o.voiceProfile&&w(!0)})},[]),n.useEffect(()=>{i===2&&!c&&!t&&!d&&b()},[i,c,t,d,b]),n.useEffect(()=>{i===2&&t&&!c&&l(3)},[i,t,c,l]);const z=async()=>{await m(),y({type:"success",message:"Voice profile saved successfully"}),h&&h()},s=()=>{h&&(v(),h())};return i===1?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:s,className:"text-muted-foreground hover:text-foreground transition-colors p-1 -ml-1","aria-label":"Back to settings",children:e.jsx(E,{size:18})}),e.jsx("h2",{className:"text-base font-semibold leading-tight text-foreground",children:"Voice Training"})]}),C&&e.jsx(M,{variant:"warning",action:{label:"Cancel",onClick:s},children:"You already have a voice profile. Training a new one will replace it."}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium leading-tight text-foreground mb-2",children:"Step 1: Add Your Messages"}),e.jsx("p",{className:"text-[13px] leading-relaxed text-muted-foreground mb-4",children:`Paste 10-20 example DMs you've sent. Separate each message with "---".`})]}),e.jsx("textarea",{value:j,onChange:o=>f(o.target.value),placeholder:`Hey! Saw your post about...

---

That's really interesting. I've been...

---

Would love to chat more about...`,className:"w-full h-64 px-4 py-3 bg-card border border-border rounded-lg text-[13px] leading-relaxed text-foreground placeholder-muted-foreground focus:outline-none focus:border-foreground/30 resize-none font-mono transition-colors"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs leading-normal text-muted-foreground font-numerical",children:[p," message",p!==1?"s":""," detected"]}),e.jsx("span",{className:"text-xs leading-normal text-muted-foreground",children:"Min: 5 · Recommended: 10-20"})]}),d&&e.jsx("p",{className:"text-xs leading-normal text-destructive",children:d}),e.jsx(S,{onClick:()=>l(2),disabled:p<5,variant:"primary",size:"md",className:"w-full",children:"Analyze My Voice →"})]}):i===2?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:s,className:"text-muted-foreground hover:text-foreground transition-colors p-1 -ml-1","aria-label":"Back to settings",children:e.jsx(E,{size:18})}),e.jsx("h2",{className:"text-base font-semibold leading-tight text-foreground",children:"Voice Training"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium leading-tight text-foreground mb-2",children:"Step 2: Analyzing Your Voice"}),e.jsx("p",{className:"text-[13px] leading-relaxed text-muted-foreground",children:"Extracting your unique writing style..."})]}),c&&e.jsxs("div",{className:"space-y-3",children:[x.tone!==void 0&&e.jsx("div",{className:"animate-fade-in",children:e.jsx(g,{variant:"success",dot:!0,size:"md",children:"Tone detected"})}),x.openingPatterns&&e.jsx("div",{className:"animate-fade-in",children:e.jsx(g,{variant:"success",dot:!0,size:"md",children:"Opening patterns found"})}),x.closingPatterns&&e.jsx("div",{className:"animate-fade-in",children:e.jsx(g,{variant:"success",dot:!0,size:"md",children:"Closing patterns found"})}),x.personalityMarkers&&e.jsx("div",{className:"animate-fade-in",children:e.jsx(g,{variant:"success",dot:!0,size:"md",children:"Personality markers identified"})}),x.avoidPhrases&&e.jsx("div",{className:"animate-fade-in",children:e.jsx(g,{variant:"success",dot:!0,size:"md",children:"Avoidances analyzed"})}),x.vocabularySignature&&e.jsx("div",{className:"animate-fade-in",children:e.jsx(g,{variant:"success",dot:!0,size:"md",children:"Vocabulary signature captured"})})]}),d&&e.jsx(M,{variant:"error",action:{label:"← Go back",onClick:()=>l(1)},children:d}),e.jsx(S,{onClick:()=>{v(),l(1)},variant:"ghost",size:"md",className:"w-full",children:"Cancel"})]}):i===3&&t?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:s,className:"text-muted-foreground hover:text-foreground transition-colors p-1 -ml-1","aria-label":"Back to settings",children:e.jsx(E,{size:18})}),e.jsx("h2",{className:"text-base font-semibold leading-tight text-foreground",children:"Voice Training"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium leading-tight text-foreground mb-2",children:"Step 3: Review Your Voice Profile"}),e.jsx("p",{className:"text-[13px] leading-relaxed text-muted-foreground",children:"Review and edit your voice fingerprint before saving."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(P,{variant:"default",children:e.jsxs(k,{className:"p-4",children:[e.jsx("label",{className:"text-xs leading-normal text-muted-foreground block mb-2",children:"Tone"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"range",min:"0",max:"10",value:t.tone,readOnly:!0,className:"flex-1 accent-foreground"}),e.jsxs("span",{className:"text-[13px] leading-relaxed font-numerical text-foreground w-8 text-right",children:[t.tone,"/10"]})]}),e.jsx("p",{className:"text-xs leading-normal text-muted-foreground mt-2",children:t.tone<=3?"Formal & Professional":t.tone<=7?"Balanced":"Casual & Friendly"})]})}),e.jsx(P,{variant:"default",children:e.jsxs(k,{className:"p-4",children:[e.jsx("label",{className:"text-xs leading-normal text-muted-foreground block mb-2",children:"Opening Patterns"}),e.jsx("div",{className:"space-y-1",children:t.openingPatterns.map((o,a)=>e.jsxs("p",{className:"text-xs leading-normal text-muted-foreground font-mono",children:['"',o,'"']},a))})]})}),e.jsx(P,{variant:"default",children:e.jsxs(k,{className:"p-4",children:[e.jsx("label",{className:"text-xs leading-normal text-muted-foreground block mb-2",children:"Personality Markers"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.personalityMarkers.map((o,a)=>e.jsx(g,{variant:"default",size:"sm",children:o},a))})]})}),e.jsx(P,{variant:"default",children:e.jsxs(k,{className:"p-4",children:[e.jsx("label",{className:"text-xs leading-normal text-muted-foreground block mb-2",children:"Vocabulary Signature"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.vocabularySignature.map((o,a)=>e.jsx(g,{variant:"info",size:"sm",children:o},a))})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{onClick:()=>l(1),variant:"secondary",size:"md",className:"flex-1",children:"← Back"}),e.jsx(S,{onClick:z,variant:"primary",size:"md",className:"flex-1",children:"Save Voice Profile"})]})]}):null}export{q as default};
