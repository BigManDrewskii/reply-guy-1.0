import{c as S,d as v,r as c,j as e}from"./sidepanel-D7LXy8vl.js";import{l as A,B as T,d as M}from"./badge-D08nYiI0.js";import{I}from"./input-B79U8FWg.js";import{C as k,a as C}from"./card-Cy_DCTpp.js";import{C as V}from"./dialog-DJmp8J32.js";import"./button-nkOSNevf.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=S("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=S("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=S("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);function B(o,f,d){var h,u;typeof o=="function"?(h=f||[],u=d):(h=[],u=f);var n=v.useRef({hasResult:!1,result:u,error:null}),N=v.useReducer(function(a){return a+1},0);N[0];var j=N[1],p=v.useMemo(function(){var a=typeof o=="function"?o():o;if(!a||typeof a.subscribe!="function")throw o===a?new TypeError("Given argument to useObservable() was neither a valid observable nor a function."):new TypeError("Observable factory given to useObservable() did not return a valid observable.");if(!n.current.hasResult&&typeof window<"u"&&(typeof a.hasValue!="function"||a.hasValue()))if(typeof a.getValue=="function")n.current.result=a.getValue(),n.current.hasResult=!0;else{var i=a.subscribe(function(l){n.current.result=l,n.current.hasResult=!0});typeof i=="function"?i():i.unsubscribe()}return a},h);if(v.useDebugValue(n.current.result),v.useEffect(function(){var a=p.subscribe(function(i){var l=n.current;(l.error!==null||l.result!==i)&&(l.error=null,l.result=i,l.hasResult=!0,j())},function(i){var l=n.current;l.error!==i&&(l.error=i,j())});return typeof a=="function"?a:a.unsubscribe.bind(a)},h),n.current.error)throw n.current.error;return n.current.result}function P(o,f,d){return B(function(){return A(o)},f||[],d)}function J(){const[o,f]=c.useState(""),[d,h]=c.useState("all"),[u,n]=c.useState(null),[N,j]=c.useState(!1),[p,a]=c.useState(!1),[i,l]=c.useState(null),R=30,x=P(()=>M.conversations.orderBy("sentAt").reverse().limit(100).toArray(),[],[]);c.useEffect(()=>{const t=window.matchMedia("(prefers-reduced-motion: reduce)");j(t.matches);const s=()=>j(t.matches);return t.addEventListener("change",s),()=>t.removeEventListener("change",s)},[]);const w=c.useMemo(()=>{let t=x;if(d!=="all"&&(t=t.filter(s=>s.platform===d)),o){const s=o.toLowerCase();t=t.filter(r=>r.pageName.toLowerCase().includes(s)||r.sentMessage.toLowerCase().includes(s))}return t},[x,d,o]),g=c.useMemo(()=>{if(!x.length)return null;const t=x.length,s={},r={sent:0,responded:0,no_response:0},m=x.filter(b=>Date.now()-b.sentAt<10080*60*1e3).length;x.forEach(b=>{s[b.platform]=(s[b.platform]||0)+1,r[b.status]=(r[b.status]||0)+1});const y=t>0?Math.round(r.responded/t*100):0;return{total:t,byPlatform:s,byStatus:r,last7Days:m,responseRate:y}},[x]),E=async t=>{await M.conversations.delete(t),l(null),n(null)},L=(t=>{const s={};return t.forEach(r=>{const m=new Date(r.sentAt).toLocaleDateString();s[m]||(s[m]=[]),s[m].push(r)}),s})(w),D=t=>{switch(t){case"x":return"ð•";case"linkedin":return"in";case"github":return"GH";default:return"ðŸŒ"}};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx(I,{placeholder:"Search conversations...",variant:"bordered",size:"md",leftIcon:e.jsx($,{size:16}),value:o,onChange:t=>f(t.target.value),"aria-label":"Search conversations"})}),g&&e.jsx("button",{onClick:()=>a(!p),className:`px-3 rounded-lg border transition-colors ${p?"bg-foreground text-background border-foreground":"bg-card text-muted-foreground border-border hover:text-foreground"}`,"aria-label":"Toggle analytics","aria-pressed":p,children:e.jsx(z,{size:16})})]}),p&&g&&e.jsx(k,{variant:"default",children:e.jsxs(C,{className:"p-4 space-y-3",children:[e.jsx("h3",{className:"text-sm font-semibold leading-tight text-foreground",children:"Analytics"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg font-bold font-numerical text-foreground",children:g.total}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Total Sent"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg font-bold font-numerical text-foreground",children:g.last7Days}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Last 7 Days"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-lg font-bold font-numerical text-foreground",children:[g.responseRate,"%"]}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Response Rate"})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 pt-2 border-t border-border",children:Object.entries(g.byPlatform).map(([t,s])=>e.jsxs(T,{variant:"default",size:"sm",children:[D(t)," ",s]},t))})]})}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:["all","x","linkedin","github","generic"].map(t=>e.jsx("button",{onClick:()=>h(t),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-all ${d===t?"bg-foreground text-background":"bg-muted text-muted-foreground hover:bg-card"}`,"aria-pressed":d===t,children:t==="all"?"All":t.charAt(0).toUpperCase()+t.slice(1)},t))}),w.length===0?e.jsx(k,{variant:"default",children:e.jsx(C,{className:"p-8 text-center",children:e.jsx("p",{className:"text-[13px] leading-relaxed text-muted-foreground",children:o||d!=="all"?"No conversations match your search":"No conversations yet. Copy and send a message to start tracking."})})}):Object.entries(L).map(([t,s])=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-semibold leading-tight text-muted-foreground px-1",children:t===new Date().toLocaleDateString()?"Today":t}),s.map(r=>{const m=w.findIndex(y=>y.id===r.id);return e.jsx(k,{variant:"default",className:`cursor-pointer transition-all ${u===r.id?"ring-1 ring-foreground/20":""}`,style:N?{opacity:1}:{animation:`fade-in-up ${m*R}ms forwards`,opacity:0},onClick:()=>n(u===r.id?null:r.id),children:e.jsx(C,{className:"p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-muted flex items-center justify-center text-[10px] leading-normal font-numerical",children:D(r.platform)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("h4",{className:"text-sm font-semibold leading-tight text-foreground truncate",children:r.pageName}),e.jsx("span",{className:"text-xs leading-normal text-muted-foreground font-numerical flex-shrink-0",children:new Date(r.sentAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),u!==r.id&&e.jsx("p",{className:"text-[13px] leading-relaxed text-muted-foreground truncate mt-1",children:r.sentMessage}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full ${r.status==="sent"?"bg-info":r.status==="responded"?"bg-success":"bg-muted-foreground"}`}),e.jsx("span",{className:"text-xs leading-normal text-muted-foreground capitalize",children:r.status.replace("_"," ")})]}),u===r.id&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-border",children:[e.jsx("p",{className:"text-[13px] leading-relaxed text-foreground whitespace-pre-wrap",children:r.sentMessage}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsxs("span",{className:"text-xs leading-normal text-muted-foreground",children:["Angle: ",r.angle]}),e.jsx("button",{onClick:y=>{y.stopPropagation(),l({id:r.id,name:r.pageName})},className:"text-destructive hover:text-destructive/80 transition-colors","aria-label":`Delete conversation with ${r.pageName}`,children:e.jsx(O,{size:14})})]})]})]})]})})},r.id)})]},t)),i&&e.jsx(V,{title:"Delete Conversation?",description:`Delete the conversation with ${i.name}? This action cannot be undone.`,confirmLabel:"Delete",onConfirm:()=>E(i.id),onClose:()=>l(null)})]})}export{J as default};
